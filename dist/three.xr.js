!function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.WebXRUtils=t.WebXRManager=void 0;var i=n(1),a=r(i),o=n(2),s=r(o);n(3),t.WebXRManager=a.default,t.WebXRUtils=s.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),THREE.WebXRManager=function(){function e(e){if(this.sessionActive){this.session.requestFrame(u);var t=e.getDisplayPose(e.getCoordinateSystem(XRCoordinateSystem.HEAD_MODEL));if(0===t._orientation[0]&&0===t._orientation[1]&&0===t._orientation[2]&&1===t._orientation[3]?this.poseFound&&(this.dispatchEvent({type:"poseLost"}),this.poseFound=!1):this.poseFound||(this.dispatchEvent({type:"poseFound"}),this.poseFound=!0),this.updateScene(o,e),this.renderer.autoClear=!1,this.renderer.setSize(this.session.baseLayer.framebufferWidth,this.session.baseLayer.framebufferHeight,!1),this.renderer.clear(),this.poseTarget.matrixAutoUpdate=!1,this.poseTarget.matrix.fromArray(t.poseModelMatrix),this.poseTarget.matrix.decompose(this.poseTarget.position,this.poseTarget.quaternion,this.poseTarget.scale),this.poseTarget.updateMatrixWorld(!0),this.sessionActive)for(var n=0;n<e.views.length;n++){var r=e.views[n];this.camera.matrixWorldInverse.fromArray(r.viewMatrix),this.camera.projectionMatrix.fromArray(r.projectionMatrix),this.renderer.clearDepth();var i=r.getViewport(this.session.baseLayer);this.renderer.setViewport(i.x,i.y,i.width,i.height),this.doRender()}else this.renderer.clearDepth(),this.renderer.setViewport(0,0,window.innerWidth,window.innerHeight),this.doRender()}}var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1],r=arguments[2],i=arguments[3],a=arguments[4],o=arguments[5],s={AR_AUTOSTART:!0};this.options=Object.assign({},s,t),this.displays=n,this.renderer=r,this.camera=i,this.scene=a;var u=e.bind(this);this.sessions=[],this.session=null,this.autoStarted=!1,this.matrixWorldInverse=new THREE.Matrix4,this.poseFound=!1,this.startSession=function(e,t,n){var i=this,a=!1;"vr"===t&&(a=!0);var o={exclusive:a,type:a?XRSession.REALITY:XRSession.AUGMENTATION};if(!this.sessionActive){null!==this.session&&(this.session.end(),this.session=null);var s=this;e.requestSession(o).then(function(e){i.session=e,e.realityType=t,e.depthNear=.05,e.depthFar=1e3,i.domElementOriginal=r.domElement.parentNode,i.cameraCloned=i.camera.clone(),i.camera.parent&&"Scene"!==i.camera.parent.type?i.poseTarget=i.camera.parent:i.poseTarget=i.camera,i.poseTargetCloned=i.poseTarget.clone(),e.addEventListener("focus",function(e){i.handleSessionFocus(e)}),e.addEventListener("blur",function(e){i.handleSessionBlur(e)}),e.addEventListener("end",function(e){i.handleSessionEnded(e)}),r.domElement.style.width="100%",r.domElement.style.height="100%","ar"===t&&n&&s.startPresenting()}).catch(function(e){console.error("Error requesting session",e)})}},this.startPresenting=function(){var e=this;c&&c._vrDisplay?(r.vr.enabled=!0,c._vrDisplay.isPresenting?c._vrDisplay.exitPresent():c._vrDisplay.requestPresent([{source:this.renderer.domElement}])):(this.session.baseLayer=new XRWebGLLayer(this.session,r.context),this.session.baseLayer.addEventListener("focus",function(t){e.handleLayerFocus(t)}),this.session.baseLayer.addEventListener("blur",function(t){e.handleLayerBlur(t)}),this.session.requestFrame(u),this.sessions.push(this.session),this.sessionActive=!0),document.getElementsByClassName("webxr-sessions")[0]&&(document.getElementsByClassName("webxr-sessions")[0].style.display="block"),this.dispatchEvent({type:"sessionStarted",session:this.session})},this.endSession=function(){this.session.end(),this.dispatchEvent({type:"sessionEnded",session:this.session}),this.sessionActive=!1,this.session._display._vrDisplay&&this.session._display.isPresenting&&(r.vr.enabled=!1,this.session._display._vrDisplay.exitPresent()),this.domElementOriginal.appendChild(this.session.baseLayer._context.canvas),this.poseTarget.matrixAutoUpdate=!1,this.poseTarget.matrix.copy(this.poseTargetCloned.matrix),this.poseTarget.updateMatrixWorld(!0),this.camera.matrixWorldInverse.copy(this.cameraCloned.matrixWorldInverse),this.camera.projectionMatrix.copy(this.cameraCloned.projectionMatrix),this.camera.updateProjectionMatrix(),document.getElementsByClassName("webxr-sessions")[0].style.display="none"},this.handleSessionFocus=function(e){console.log("handleSessionFocus")},this.handleSessionBlur=function(e){console.log("handleSessionBlur")},this.handleSessionEnded=function(e){console.log("handleSessionEnded")},this.handleLayerFocus=function(e){console.log("handleLayerFocus")},this.handleLayerBlur=function(e){console.log("handleLayerBlur")};var l,c,h=0,f=0;this.totalSupportedDisplays=0;for(var d=0;d<this.displays.length;d++){var _=this.displays[d];_.supportedRealities.vr&&(c=_,this.renderer.vr.setDevice(c._vrDisplay),h++),_.supportedRealities.ar&&(l=_,f++)}1===f&&0===h&&this.options.AR_AUTOSTART&&(this.autoStarted=!0,this.startSession(l,"ar",!0)),0===f&&1===h&&this.startSession(c,"vr",!1),this.totalSupportedDisplays=f+h,this.updateScene=function(e,t){e(t)},this.doRender=function(){this.renderer.render(this.scene,this.camera)}},THREE.WebXRManager.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.WebXRManager.prototype.constructor=THREE.WebXRManager,t.default=THREE.WebXRManager},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),THREE.WebXRUtils={getDisplays:function(){return new Promise(function(e,t){navigator.XR?navigator.XR.getDisplays().then(function(t){function n(){return void 0!==window.orientation||-1!==navigator.userAgent.indexOf("IEMobile")}if(0===t.length)return console.log("No displays are available"),void e(null);var r={exclusive:!1,type:XRSession.AUGMENTATION},i={exclusive:!0,type:XRSession.REALITY},a={vr:!1,ar:!1},o=!0,s=!1,u=void 0;try{for(var l,c=t[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){var h=l.value;a={vr:!1,ar:!1},h.supportsSession(r)&&((h._reality._vrDisplay||!n()||function(){return-1!==navigator.userAgent.indexOf("AppleWebKit")&&-1===navigator.userAgent.indexOf("Safari")}())&&n()?a.ar=!0:a.ar=!1),h.supportsSession(i)&&-1===h._displayName.indexOf("polyfill")&&(a.vr=!0),h.supportedRealities=a}}catch(e){s=!0,u=e}finally{try{!o&&c.return&&c.return()}finally{if(s)throw u}}e(t)}).catch(function(t){console.error("Error getting XR displays",t),e(null)}):(console.log("WebXR polyfill is not found"),e(null))})}},t.default=THREE.WebXRUtils},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=18)}([function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(1),o=function(e){return e&&e.__esModule?e:{default:e}}(a),s=function(){function e(){r(this,e)}return i(e,null,[{key:"mat4_generateIdentity",value:function(){return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},{key:"mat4_get_position",value:function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}},{key:"mat4_get_rotation",value:function(e,t){var n=new o.default;return n.setFromRotationMatrix(t),e[0]=n.x,e[1]=n.y,e[2]=n.z,e[3]=n.w,e}},{key:"mat4_eyeView",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Float32Array([0,0,0]);e.mat4_translate(t,n,r),e.mat4_invert(t,t)}},{key:"mat4_perspectiveFromFieldOfView",value:function(t,n,r,i){var a=Math.tan(n.upDegrees*e.PI_OVER_180),o=Math.tan(n.downDegrees*e.PI_OVER_180),s=Math.tan(n.leftDegrees*e.PI_OVER_180),u=Math.tan(n.rightDegrees*e.PI_OVER_180),l=2/(s+u),c=2/(a+o);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(s-u)*l*.5,t[9]=(a-o)*c*.5,t[10]=i/(r-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*r/(r-i),t[15]=0,t}},{key:"mat4_fromRotationTranslation",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0,1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0],r=t[0],i=t[1],a=t[2],o=t[3],s=r+r,u=i+i,l=a+a,c=r*s,h=r*u,f=r*l,d=i*u,_=i*l,v=a*l,p=o*s,y=o*u,m=o*l;return e[0]=1-(d+v),e[1]=h+m,e[2]=f-y,e[3]=0,e[4]=h-m,e[5]=1-(c+v),e[6]=_+p,e[7]=0,e[8]=f+y,e[9]=_-p,e[10]=1-(c+d),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}},{key:"mat4_translate",value:function(e,t,n){var r=n[0],i=n[1],a=n[2],o=void 0,s=void 0,u=void 0,l=void 0,c=void 0,h=void 0,f=void 0,d=void 0,_=void 0,v=void 0,p=void 0,y=void 0;return t===e?(e[12]=t[0]*r+t[4]*i+t[8]*a+t[12],e[13]=t[1]*r+t[5]*i+t[9]*a+t[13],e[14]=t[2]*r+t[6]*i+t[10]*a+t[14],e[15]=t[3]*r+t[7]*i+t[11]*a+t[15]):(o=t[0],s=t[1],u=t[2],l=t[3],c=t[4],h=t[5],f=t[6],d=t[7],_=t[8],v=t[9],p=t[10],y=t[11],e[0]=o,e[1]=s,e[2]=u,e[3]=l,e[4]=c,e[5]=h,e[6]=f,e[7]=d,e[8]=_,e[9]=v,e[10]=p,e[11]=y,e[12]=o*r+c*i+_*a+t[12],e[13]=s*r+h*i+v*a+t[13],e[14]=u*r+f*i+p*a+t[14],e[15]=l*r+d*i+y*a+t[15]),e}},{key:"mat4_invert",value:function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=t[9],f=t[10],d=t[11],_=t[12],v=t[13],p=t[14],y=t[15],m=n*s-r*o,b=n*u-i*o,w=n*l-a*o,g=r*u-i*s,E=r*l-a*s,M=i*l-a*u,x=c*v-h*_,T=c*p-f*_,A=c*y-d*_,R=h*p-f*v,O=h*y-d*v,P=f*y-d*p,k=m*P-b*O+w*R+g*A-E*T+M*x;return k?(k=1/k,e[0]=(s*P-u*O+l*R)*k,e[1]=(i*O-r*P-a*R)*k,e[2]=(v*M-p*E+y*g)*k,e[3]=(f*E-h*M-d*g)*k,e[4]=(u*A-o*P-l*T)*k,e[5]=(n*P-i*A+a*T)*k,e[6]=(p*w-_*M-y*b)*k,e[7]=(c*M-f*w+d*b)*k,e[8]=(o*O-s*A+l*x)*k,e[9]=(r*A-n*O-a*x)*k,e[10]=(_*E-v*w+y*m)*k,e[11]=(h*w-c*E-d*m)*k,e[12]=(s*T-o*R-u*x)*k,e[13]=(n*R-r*T+i*x)*k,e[14]=(v*b-_*g-p*m)*k,e[15]=(c*g-h*b+f*m)*k,e):null}},{key:"mat4_multiply",value:function(e,t,n){var r=t[0],i=t[4],a=t[8],o=t[12],s=t[1],u=t[5],l=t[9],c=t[13],h=t[2],f=t[6],d=t[10],_=t[14],v=t[3],p=t[7],y=t[11],m=t[15],b=n[0],w=n[4],g=n[8],E=n[12],M=n[1],x=n[5],T=n[9],A=n[13],R=n[2],O=n[6],P=n[10],k=n[14],S=n[3],I=n[7],N=n[11],C=n[15];return e[0]=r*b+i*M+a*R+o*S,e[4]=r*w+i*x+a*O+o*I,e[8]=r*g+i*T+a*P+o*N,e[12]=r*E+i*A+a*k+o*C,e[1]=s*b+u*M+l*R+c*S,e[5]=s*w+u*x+l*O+c*I,e[9]=s*g+u*T+l*P+c*N,e[13]=s*E+u*A+l*k+c*C,e[2]=h*b+f*M+d*R+_*S,e[6]=h*w+f*x+d*O+_*I,e[10]=h*g+f*T+d*P+_*N,e[14]=h*E+f*A+d*k+_*C,e[3]=v*b+p*M+y*R+m*S,e[7]=v*w+p*x+y*O+m*I,e[11]=v*g+p*T+y*P+m*N,e[15]=v*E+p*A+y*k+m*C,e}}]),e}();t.default=s,s.PI_OVER_180=Math.PI/180},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;r(this,e),this.x=t,this.y=n,this.z=i,this.w=a}return i(e,[{key:"set",value:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}},{key:"toArray",value:function(){return[this.x,this.y,this.z,this.w]}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:"setFromRotationMatrix",value:function(e){var t=e[0],n=e[4],r=e[8],i=e[1],a=e[5],o=e[9],s=e[2],u=e[6],l=e[10],c=t+a+l;if(c>0){var h=.5/Math.sqrt(c+1);this.w=.25/h,this.x=(u-o)*h,this.y=(r-s)*h,this.z=(i-n)*h}else if(t>a&&t>l){var f=2*Math.sqrt(1+t-a-l);this.w=(u-o)/f,this.x=.25*f,this.y=(n+i)/f,this.z=(r+s)/f}else if(a>l){var d=2*Math.sqrt(1+a-t-l);this.w=(r-s)/d,this.x=(n+i)/d,this.y=.25*d,this.z=(o+u)/d}else{var _=2*Math.sqrt(1+l-t-a);this.w=(i-n)/_,this.x=(r+s)/_,this.y=(o+u)/_,this.z=.25*_}return this}},{key:"setFromEuler",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"XYZ",i=Math.cos,a=Math.sin,o=i(e/2),s=i(t/2),u=i(n/2),l=a(e/2),c=a(t/2),h=a(n/2);"XYZ"===r?(this.x=l*s*u+o*c*h,this.y=o*c*u-l*s*h,this.z=o*s*h+l*c*u,this.w=o*s*u-l*c*h):"YXZ"===r?(this.x=l*s*u+o*c*h,this.y=o*c*u-l*s*h,this.z=o*s*h-l*c*u,this.w=o*s*u+l*c*h):"ZXY"===r?(this.x=l*s*u-o*c*h,this.y=o*c*u+l*s*h,this.z=o*s*h+l*c*u,this.w=o*s*u-l*c*h):"ZYX"===r?(this.x=l*s*u-o*c*h,this.y=o*c*u+l*s*h,this.z=o*s*h-l*c*u,this.w=o*s*u+l*c*h):"YZX"===r?(this.x=l*s*u+o*c*h,this.y=o*c*u+l*s*h,this.z=o*s*h-l*c*u,this.w=o*s*u-l*c*h):"XZY"===r&&(this.x=l*s*u-o*c*h,this.y=o*c*u-l*s*h,this.z=o*s*h+l*c*u,this.w=o*s*u+l*c*h)}},{key:"setFromAxisAngle",value:function(e,t){var n=t/2,r=Math.sin(n);return this.x=e.x*r,this.y=e.y*r,this.z=e.z*r,this.w=Math.cos(n),this}},{key:"multiply",value:function(e){return this.multiplyQuaternions(this,e)}},{key:"multiplyQuaternions",value:function(e,t){var n=e.x,r=e.y,i=e.z,a=e.w,o=t.x,s=t.y,u=t.z,l=t.w;return this.x=n*l+a*o+r*u-i*s,this.y=r*l+a*s+i*o-n*u,this.z=i*l+a*u+n*s-r*o,this.w=a*l-n*o-r*s-i*u,this}},{key:"inverse",value:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this}},{key:"normalize",value:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===e?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/e,this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e),this}},{key:"slerp",value:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this.x,r=this.y,i=this.z,a=this.w,o=a*e.w+n*e.x+r*e.y+i*e.z;if(o<0?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,o=-o):this.copy(e),o>=1)return this.w=a,this.x=n,this.y=r,this.z=i,this;var s=Math.acos(o),u=Math.sqrt(1-o*o);if(Math.abs(u)<.001)return this.w=.5*(a+this.w),this.x=.5*(n+this.x),this.y=.5*(r+this.y),this.z=.5*(i+this.z),this;var l=Math.sin((1-t)*s)/u,c=Math.sin(t*s)/u;return this.w=a*l+this.w*c,this.x=n*l+this.x*c,this.y=r*l+this.y*c,this.z=i*l+this.z*c,this}}]),e}();t.default=a},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e),this._listeners=new Map}return i(e,[{key:"addEventListener",value:function(e,t){var n=this._listeners.get(e);!1===Array.isArray(n)&&(n=[],this._listeners.set(e,n)),n.push(t)}},{key:"removeEventListener",value:function(e,t){var n=this._listeners.get(e);if(!1!==Array.isArray(n))for(var r=0;r<n.length;r++)if(n[r]===t)return void n.splice(r,1)}},{key:"dispatchEvent",value:function(e){var t=this._listeners.get(e.type);if(!1!==Array.isArray(t)){var n=t.slice(0),r=!0,i=!1,a=void 0;try{for(var o,s=n[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){(0,o.value)(e)}}catch(e){i=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}}}}]),e}();t.default=a},function(e,t,n){function r(e){t.ARRAY_TYPE=s=e}function i(e){return e*u}function a(e,t){return Math.abs(e-t)<=o*Math.max(1,Math.abs(e),Math.abs(t))}Object.defineProperty(t,"__esModule",{value:!0}),t.setMatrixArrayType=r,t.toRadian=i,t.equals=a;var o=t.EPSILON=1e-6,s=t.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,u=(t.RANDOM=Math.random,Math.PI/180)},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;r(this,e),this._uid=n||e._generateUID(),this._coordinateSystem=t}return i(e,[{key:"uid",get:function(){return this._uid}},{key:"coordinateSystem",get:function(){return this._coordinateSystem}}],[{key:"_generateUID",value:function(){return"anchor-"+(new Date).getTime()+"-"+Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)}}]),e}();t.default=a},function(e,t,n){function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(0),c=i(l),h=n(2),f=i(h),d=n(19),_=i(d),v=n(20),p=i(v),y=function(e){function t(e,n,r,i){a(this,t);var s=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));s._xr=e,s._displayName=n,s._isExternal=r,s._reality=i,s._headModelCoordinateSystem=new XRCoordinateSystem(s,XRCoordinateSystem.HEAD_MODEL),s._eyeLevelCoordinateSystem=new XRCoordinateSystem(s,XRCoordinateSystem.EYE_LEVEL),s._trackerCoordinateSystem=new XRCoordinateSystem(s,XRCoordinateSystem.TRACKER),s._headPose=new XRViewPose([0,XRViewPose.SITTING_EYE_HEIGHT,0]),s._eyeLevelPose=new XRViewPose([0,XRViewPose.SITTING_EYE_HEIGHT,0]),s._trackerPoseModelMatrix=c.default.mat4_generateIdentity();return s._fov=new p.default(25,25,25,25),s._depthNear=.1,s._depthFar=1e3,s._views=[],s}return s(t,e),u(t,[{key:"supportsSession",value:function(e){return this._supportedCreationParameters(e)}},{key:"requestSession",value:function(e){var t=this;return new Promise(function(n,r){if(!1===t._supportedCreationParameters(e))return void r();e.type===XRSession.REALITY&&(t._reality=new _.default,t._xr._privateRealities.push(t._reality)),n(t._createSession(e))})}},{key:"_requestVideoFrame",value:function(e){}},{key:"_requestAnimationFrame",value:function(e){return window.requestAnimationFrame(e)}},{key:"_cancelAnimationFrame",value:function(e){return window.cancelAnimationFrame(e)}},{key:"_createSession",value:function(e){return new XRSession(this._xr,this,e)}},{key:"_supportedCreationParameters",value:function(e){throw"Should be implemented by extending class"}},{key:"_handleNewFrame",value:function(e){}},{key:"_handleAfterFrame",value:function(e){}},{key:"_handleNewBaseLayer",value:function(e){}},{key:"displayName",get:function(){return this._displayName}},{key:"isExternal",get:function(){return this._isExternal}}]),t}(f.default);t.default=y},function(e,t,n){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(2),l=function(e){return e&&e.__esModule?e:{default:e}}(u),c=function(e){function t(e,n,r,o){i(this,t);var s=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return s._xr=e,s._name=n,s._isShared=r,s._isPassthrough=o,s._anchors=new Map,s}return o(t,e),s(t,[{key:"getCoordinateSystem",value:function(){throw new Error("Not implemented")}},{key:"_start",value:function(e){throw new Error("Exending classes should implement _start")}},{key:"_stop",value:function(){throw new Error("Exending classes should implement _stop")}},{key:"_handleNewFrame",value:function(){}},{key:"_addAnchor",value:function(e,t){throw new Error("Exending classes should implement _addAnchor")}},{key:"_findAnchor",value:function(e,t,n){throw new Error("Exending classes should implement _findAnchor")}},{key:"_findFloorAnchor",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];throw new Error("Exending classes should implement _findFloorAnchor")}},{key:"_getAnchor",value:function(e){return this._anchors.get(e)||null}},{key:"_removeAnchor",value:function(e){throw new Error("Exending classes should implement _removeAnchor")}},{key:"_hitTestNoAnchor",value:function(e,t,n){throw new Error("Exending classes should implement _hitTestNoAnchor")}},{key:"_getLightAmbientIntensity",value:function(){throw new Error("Exending classes should implement _getLightAmbientIntensity")}},{key:"name",get:function(){return this._name}},{key:"isShared",get:function(){return this._isShared}},{key:"isPassthrough",get:function(){return this._isPassthrough}}]),t}(l.default);t.default=c},function(e,t,n){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(2),l=function(e){return e&&e.__esModule?e:{default:e}}(u),c=function(e){function t(e,n,r){i(this,t);var o=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return o._xr=e,o._display=n,o._createParameters=r,o._ended=!1,o._baseLayer=null,o._stageBounds=null,o}return o(t,e),s(t,[{key:"requestFrame",value:function(e){var t=this;if(this._ended)return null;if("function"!=typeof e)throw"Invalid callback";return this._display._requestAnimationFrame(function(){var n=t._createPresentationFrame();t._display._reality._handleNewFrame(n),t._display._handleNewFrame(n),e(n),t._display._handleAfterFrame(n)})}},{key:"cancelFrame",value:function(e){return this._display._cancelAnimationFrame(e)}},{key:"end",value:function(){if(!this._ended)return this._ended=!0,this._display._stop(),new Promise(function(e,t){e()})}},{key:"setVideoFrameHandler",value:function(e){if(e instanceof Worker){var t=e;e=function(e){for(var n=e.detail,r=n.frame.buffers,i=[],a=0;a<r.length;a++)i.push(r[a].buffer);t.postMessage(n,i)}}this._display.addEventListener("videoFrame",e)}},{key:"requestVideoFrame",value:function(e){this._display._requestVideoFrame(e)}},{key:"_createPresentationFrame",value:function(){return new XRPresentationFrame(this)}},{key:"_getCoordinateSystem",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){switch(o.value){case XRCoordinateSystem.HEAD_MODEL:return this._display._headModelCoordinateSystem;case XRCoordinateSystem.EYE_LEVEL:return this._display._eyeLevelCoordinateSystem;case XRCoordinateSystem.TRACKER:return this._display._trackerCoordinateSystem;case XRCoordinateSystem.GEOSPATIAL:default:continue}}}catch(e){i=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return null}},{key:"display",get:function(){return this._display}},{key:"createParameters",get:function(){return this._parameters}},{key:"realities",get:function(){return this._xr._sharedRealities}},{key:"reality",get:function(){return this._display._reality}},{key:"baseLayer",get:function(){return this._baseLayer},set:function(e){this._baseLayer=e,this._display._handleNewBaseLayer(this._baseLayer)}},{key:"depthNear",get:function(){this._display._depthNear},set:function(e){this._display._depthNear=e}},{key:"depthFar",get:function(){this._display._depthFar},set:function(e){this._display._depthFar=e}},{key:"hasStageBounds",get:function(){this._stageBounds}},{key:"stageBounds",get:function(){return this._stageBounds}}]),t}(l.default);t.default=c,c.REALITY="reality",c.AUGMENTATION="augmentation",c.TYPES=[c.REALITY,c.AUGMENTATION]},function(e,t,n){function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(14),s=r(o),u=n(0),l=r(u),c=function(){function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;i(this,e),this._fov=t,this._depthNear=n,this._depthFar=r,this._eye=a,this._viewport=new s.default(0,0,1,1),this._projectionMatrix=new Float32Array(16),this._viewMatrix=new Float32Array(16),l.default.mat4_perspectiveFromFieldOfView(this._projectionMatrix,this._fov,this._depthNear,this._depthFar)}return a(e,[{key:"setProjectionMatrix",value:function(e){for(var t=0;t<16;t++)this._projectionMatrix[t]=e[t]}},{key:"setViewMatrix",value:function(e){for(var t=0;t<16;t++)this._viewMatrix[t]=e[t]}},{key:"getViewport",value:function(t){return this._eye===e.LEFT?(this._viewport.x=0,this._viewport.y=0,this._viewport.width=t.framebufferWidth/2,this._viewport.height=t.framebufferHeight):this._eye===e.RIGHT?(this._viewport.x=t.framebufferWidth/2,this._viewport.y=0,this._viewport.width=t.framebufferWidth/2,this._viewport.height=t.framebufferHeight):(this._viewport.x=0,this._viewport.y=0,this._viewport.width=t.framebufferWidth,this._viewport.height=t.framebufferHeight),this._viewport}},{key:"eye",get:function(){return this._eye}},{key:"projectionMatrix",get:function(){return this._projectionMatrix}},{key:"viewMatrix",get:function(){return this._viewMatrix}}]),e}();t.default=c,c.LEFT="left",c.RIGHT="right",c.EYES=[c.LEFT,c.RIGHT]},function(e,t,n){function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(0),s=r(o),u=n(1),l=r(u),c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0,1];i(this,e),this._poseModelMatrix=new Float32Array(16),s.default.mat4_fromRotationTranslation(this._poseModelMatrix,n,t)}return a(e,[{key:"_setPoseModelMatrix",value:function(e){for(var t=0;t<16;t++)this._poseModelMatrix[t]=e[t]}},{key:"_translate",value:function(e){this._poseModelMatrix[12]+=e[0],this._poseModelMatrix[13]+=e[1],this._poseModelMatrix[14]+=e[2]}},{key:"getViewMatrix",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null===t&&(t=new Float32Array(16)),s.default.mat4_eyeView(t,this._poseModelMatrix),t}},{key:"poseModelMatrix",get:function(){return this._poseModelMatrix}},{key:"_position",get:function(){return[this._poseModelMatrix[12],this._poseModelMatrix[13],this._poseModelMatrix[14]]},set:function(e){this._poseModelMatrix[12]=e[0],this._poseModelMatrix[13]=e[1],this._poseModelMatrix[14]=e[2]}},{key:"_orientation",get:function(){var e=new l.default;return e.setFromRotationMatrix(this._poseModelMatrix),e.toArray()},set:function(e){s.default.mat4_fromRotationTranslation(this._poseModelMatrix,e,this._position)}}]),e}();t.default=c,c.SITTING_EYE_HEIGHT=0},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;r(this,e),this.x=t,this.y=n,this.z=i}return i(e,[{key:"set",value:function(e,t,n){return this.x=e,this.y=t,this.z=n,this}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"toArray",value:function(){return[this.x,this.y,this.z]}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"add",value:function(e,t,n){this.x+=e,this.y+=t,this.z+=n}},{key:"normalize",value:function(){var e=this.length();return 0!==e?this.multiplyScalar(1/e):(this.x=0,this.y=0,this.z=0),this}},{key:"multiplyScalar",value:function(e){this.x*=e,this.y*=e,this.z*=e}},{key:"applyQuaternion",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.x,a=e.y,o=e.z,s=e.w,u=s*t+a*r-o*n,l=s*n+o*t-i*r,c=s*r+i*n-a*t,h=-i*t-a*n-o*r;return this.x=u*s+h*-i+l*-o-c*-a,this.y=l*s+h*-a+c*-i-u*-o,this.z=c*s+h*-o+u*-a-l*-i,this}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,r=this.z,i=1/(e[3]*t+e[7]*n+e[11]*r+e[15]);return this.x=(e[0]*t+e[4]*n+e[8]*r+e[12])*i,this.y=(e[1]*t+e[5]*n+e[9]*r+e[13])*i,this.z=(e[2]*t+e[6]*n+e[10]*r+e[14])*i,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"crossVectors",value:function(e,t){var n=e.x,r=e.y,i=e.z,a=t.x,o=t.y,s=t.z;return this.x=r*s-i*o,this.y=i*a-n*s,this.z=n*o-r*a,this}}]),e}();t.default=a},function(e,t,n){function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(e){return void 0===e?"undefined":r(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":r(e)},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),h=n(2),f=a(h),d=n(3),_=(i(d),n(31)),v=i(_),p=n(32),y=i(p),m=n(17),b=i(m),w=n(35),g=a(w),E=function(e){function t(){function e(){return this.modelMatrix=new Float32Array(16),this}o(this,t);var n=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(!1===t.HasARKit())throw"ARKitWrapper will only work in Mozilla's ARDemo test app";if(void 0!==t.GLOBAL_INSTANCE)throw"ARKitWrapper is a singleton. Use ARKitWrapper.GetOrCreate() to get the global instance.";n._deviceId=null,n._isWatching=!1,n._isInitialized=!1,n._rawARData=null;var r=n._buildWorkerBlob();n._worker=new Worker(r),URL.revokeObjectURL(r);var i=n;n._worker.onmessage=function(e){setTimeout(function(){i.dispatchEvent(new CustomEvent(t.COMPUTER_VISION_DATA,{source:i,detail:e.data}))})},n.lightIntensity=1e3,n.projectionMatrix_=new Float32Array(16),n.viewMatrix_=new Float32Array(16),n.planes_=new Map,n.anchors_=new Map,n._globalCallbacksMap={};for(var a=["onInit","onWatch"],u=0;u<a.length;u++)n._generateGlobalCallback(a[u],u);n._defaultOptions={location:!0,camera:!0,objects:!0,light_intensity:!0,computer_vision_data:!1},n._ab=[];for(var l=[["arkitStartRecording",t.RECORD_START_EVENT],["arkitStopRecording",t.RECORD_STOP_EVENT],["arkitDidMoveBackground",t.DID_MOVE_BACKGROUND_EVENT],["arkitWillEnterForeground",t.WILL_ENTER_FOREGROUND_EVENT],["arkitInterrupted",t.INTERRUPTED_EVENT],["arkitInterruptionEnded",t.INTERRUPTION_ENDED_EVENT],["arkitShowDebug",t.SHOW_DEBUG_EVENT],["arkitWindowResize",t.WINDOW_RESIZE_EVENT],["onError",t.ON_ERROR],["arTrackingChanged",t.AR_TRACKING_CHANGED],["userGrantedComputerVisionData",t.USER_GRANTED_COMPUTER_VISION_DATA]],c=0;c<l.length;c++)!function(e){window[l[e][0]]=function(t){t=t||null,n.dispatchEvent(new CustomEvent(l[e][1],{source:n,detail:t}))}}(c);window.onComputerVisionData=function(e){n._onComputerVisionData(e)};var i=n;return n.getPlanes=function(){return Array.from(this.planes_.values())},n.hitTestNoAnchor=function(){var t={rayStart:b.create(),rayEnd:b.create(),cameraPosition:b.create(),cameraQuaternion:y.create(),modelViewMatrix:v.create(),projectionMatrix:v.create(),projViewMatrix:v.create(),worldRayStart:b.create(),worldRayEnd:b.create(),worldRayDir:b.create(),planeMatrix:v.create(),planeExtent:b.create(),planePosition:b.create(),planeCenter:b.create(),planeNormal:b.create(),planeIntersection:b.create(),planeIntersectionLocal:b.create(),planeHit:v.create()},n=function(e,t){v.set(e,t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},r=function(){var e=b.create();return function(t,n,r,i){var a=b.dot(t,i);return b.subtract(e,n,r),b.dot(e,t)/a}}(),a=function(e,r){n(t.planeMatrix,e.modelMatrix),v.getTranslation(t.planeIntersection,t.planeMatrix);var i=b.distance(t.planeIntersection,t.cameraPosition);return n(t.planeMatrix,r.modelMatrix),v.getTranslation(t.planeIntersection,t.planeMatrix),i<b.distance(t.planeIntersection,t.cameraPosition)?-1:1};return function(o,s){if(o<0||o>1||s<0||s>1)throw new Error("hitTest - x and y values must be normalized [0,1]!");var u=[],l=this.getPlanes();if(!l||0==l.length)return u;b.set(t.rayStart,2*o-1,2*(1-s)-1,0),b.set(t.rayEnd,2*o-1,2*(1-s)-1,1),n(t.projectionMatrix,i.projectionMatrix_),n(t.modelViewMatrix,i.viewMatrix_),v.multiply(t.projViewMatrix,t.projectionMatrix,t.modelViewMatrix),v.invert(t.projViewMatrix,t.projViewMatrix),b.transformMat4(t.worldRayStart,t.rayStart,t.projViewMatrix),b.transformMat4(t.worldRayEnd,t.rayEnd,t.projViewMatrix),b.subtract(t.worldRayDir,t.worldRayEnd,t.worldRayStart),b.normalize(t.worldRayDir,t.worldRayDir);for(var c=0;c<l.length;c++){var h=l[c];n(t.planeMatrix,h.modelMatrix),b.set(t.planeCenter,0,0,0),b.transformMat4(t.planePosition,t.planeCenter,t.planeMatrix),b.set(t.planeNormal,0,1,0);var f=r(t.planeNormal,t.planePosition,t.worldRayStart,t.worldRayDir);if(!(f<0)){b.scale(t.planeIntersection,t.worldRayDir,f),b.add(t.planeIntersection,t.worldRayStart,t.planeIntersection),b.set(t.planeExtent,h.extent[0],0,h.extent[1]),v.invert(t.planeMatrix,t.planeMatrix),b.transformMat4(t.planeIntersectionLocal,t.planeIntersection,t.planeMatrix);if(!(Math.abs(t.planeIntersectionLocal[0])>t.planeExtent[0]/2+.0075||Math.abs(t.planeIntersectionLocal[2])>t.planeExtent[2]/2+.0075)){v.fromTranslation(t.planeHit,t.planeIntersection);for(var d=new e,_=0;_<16;_++)d.modelMatrix[_]=t.planeHit[_];d.i=c,u.push(d)}}}return u.sort(a),u}}(),n}return u(t,e),c(t,[{key:"waitForInit",value:function(){var e=this;return new Promise(function(n,r){if(e._isInitialized)return void n();var i=function r(){e.removeEventListener(t.INIT_EVENT,r,!1),n()};e.addEventListener(t.INIT_EVENT,i,!1)})}},{key:"getData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===e?this._rawARData:this._rawARData&&void 0!==this._rawARData[e]?this._rawARData[e]:null}},{key:"getObject",value:function(e){if(!this._isInitialized)return null;var t=this.getKey("objects");if(null===t)return null;var n=!0,r=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;if(s.uuid===e)return s}}catch(e){r=!0,i=e}finally{try{!n&&o.return&&o.return()}finally{if(r)throw i}}return null}},{key:"hitTest",value:function(e,n){var r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.HIT_TEST_TYPE_ALL;return new Promise(function(t,a){if(!r._isInitialized)return void a(new Error("ARKit is not initialized"));window.webkit.messageHandlers.hitTest.postMessage({x:e,y:n,type:i,callback:r._createPromiseCallback("hitTest",t)})})}},{key:"addAnchor",value:function(e,t){var n=this;return new Promise(function(r,i){if(!n._isInitialized)return void i(new Error("ARKit is not initialized"));window.webkit.messageHandlers.addAnchor.postMessage({uuid:e,transform:t,callback:n._createPromiseCallback("addAnchor",r)})})}},{key:"stop",value:function(){var e=this;return new Promise(function(t,n){if(!e._isWatching)return void t();console.log("----STOP"),window.webkit.messageHandlers.stopAR.postMessage({callback:e._createPromiseCallback("stop",t)})})}},{key:"watch",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!this._isInitialized)return!1;if(this._isWatching)return!0;this._isWatching=!0;var t=Object.assign({},this._defaultOptions);null!=e&&(t=Object.assign(t,e));var n={options:t,callback:this._globalCallbacksMap.onWatch};return console.log("----WATCH"),window.webkit.messageHandlers.watchAR.postMessage(n),!0}},{key:"setUIOptions",value:function(e){window.webkit.messageHandlers.setUIOptions.postMessage(e)}},{key:"_sendInit",value:function(e){console.log("----INIT"),window.webkit.messageHandlers.initAR.postMessage({options:e,callback:this._globalCallbacksMap.onInit})}},{key:"_onInit",value:function(e){this._deviceId=e,this._isInitialized=!0,this.dispatchEvent(new CustomEvent(t.INIT_EVENT,{source:this}))}},{key:"_onWatch",value:function(e){if(this._rawARData=e,this.dispatchEvent(new CustomEvent(t.WATCH_EVENT,{source:this,detail:this._rawARData})),this.lightIntensity=e.light_intensity,this.viewMatrix_=e.camera_view,this.projectionMatrix_=e.projection_camera,e.newObjects.length)for(var n=0;n<e.newObjects.length;n++){var r=e.newObjects[n];r.h_plane_center?this.planes_.set(r.uuid,{id:r.uuid,center:r.h_plane_center,extent:[r.h_plane_extent.x,r.h_plane_extent.z],modelMatrix:r.transform}):this.anchors_.set(r.uuid,{id:r.uuid,modelMatrix:r.transform})}if(e.removedObjects.length)for(var i=0;i<e.removedObjects.length;i++){var a=e.removedObjects[i];this.planes_.get(a)?this.planes_.delete(a):this.anchors_.delete(a)}if(e.objects.length)for(var o=0;o<e.objects.length;o++){var s=e.objects[o];if(s.h_plane_center){var u=this.planes_.get(s.uuid);u?(u.center=s.h_plane_center,u.extent=[s.h_plane_extent.x,s.h_plane_extent.z],u.modelMatrix=s.transform):this.planes_.set(s.uuid,{id:s.uuid,center:s.h_plane_center,extent:[s.h_plane_extent.x,s.h_plane_extent.z],modelMatrix:s.transform})}else{var l=this.anchors_.get(s.uuid);l?l.modelMatrix=s.transform:this.anchors_.set(s.uuid,{id:s.uuid,modelMatrix:s.transform})}}}},{key:"_onStop",value:function(){this._isWatching=!1}},{key:"_createPromiseCallback",value:function(e,t){var n=this,r=this._generateCallbackUID(e);return window[r]=function(i){delete window[r];var a="_on"+e[0].toUpperCase()+e.slice(1);"function"==typeof n[a]&&n[a](i),t(i)},r}},{key:"_generateCallbackUID",value:function(e){return"arkitCallback_"+e+"_"+(new Date).getTime()+"_"+Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)}},{key:"_generateGlobalCallback",value:function(e,t){var n="arkitCallback"+t;this._globalCallbacksMap[e]=n;var r=this;window[n]=function(t){r["_"+e](t)}}},{key:"_onComputerVisionData",value:function(e){if(!e)return void console.error("detail passed to _onComputerVisionData is null");if(!e.frame||!e.frame.buffers||e.frame.buffers.length<=0)return void console.error("detail passed to _onComputerVisionData is bad, no buffers");var n=e.frame.buffers;if(this._ab.length>n.length&&(this._ab=this._ab.slice(0,buffer.length)),this._worker)e.ab=this._ab,this._ab?this._worker.postMessage(e,this._ab):this._worker.postMessage(e);else{for(var r=0;r<n.length;r++){this._ab.length<=r&&this._ab.push(null);n[r].buffer.length;this._ab[r]=n[r].buffer=g.default.decodeArrayBuffer(n[r].buffer,this._ab[r]);n[r].buffer.byteLength,n[r].size.height,n[r].size.bytesPerRow}switch(e.frame.pixelFormatType){case"kCVPixelFormatType_420YpCbCr8BiPlanarFullRange":e.frame.pixelFormat="YUV420P";break;default:e.frame.pixelFormat=e.frame.pixelFormatType}this.dispatchEvent(new CustomEvent(t.COMPUTER_VISION_DATA,{source:this,detail:e}))}}},{key:"_requestComputerVisionData",value:function(e){if(e){this._ab=[];for(var t=0;t<e.length;t++)e[t]instanceof ArrayBuffer&&this._ab.push(e[t])}window.webkit.messageHandlers.requestComputerVisionData.postMessage({})}},{key:"_buildWorkerBlob",value:function(){return URL.createObjectURL(new Blob(["(",function(){var e={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",decodeArrayBuffer:function(e,t){var n=e.length/4*3;return t&&t.byteLength==n||(t=new ArrayBuffer(n)),this.decode(e,t),t},removePaddingChars:function(e){return 64==this._keyStr.indexOf(e.charAt(e.length-1))?e.substring(0,e.length-1):e},decode:function(e,t){e=this.removePaddingChars(e),e=this.removePaddingChars(e);var n,r,i,a,o,s,u,l,c=parseInt(e.length/4*3,10),h=0,f=0;for(n=t?new Uint8Array(t):new Uint8Array(c),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""),h=0;h<c;h+=3)o=this._keyStr.indexOf(e.charAt(f++)),s=this._keyStr.indexOf(e.charAt(f++)),u=this._keyStr.indexOf(e.charAt(f++)),l=this._keyStr.indexOf(e.charAt(f++)),r=o<<2|s>>4,i=(15&s)<<4|u>>2,a=(3&u)<<6|l,n[h]=r,64!=u&&(n[h+1]=i),64!=l&&(n[h+2]=a);return n}};self.addEventListener("message",function(t){var n=t.data.frame,r=(t.data.camera,t.data.ab),i=n.buffers,a=[];r.length>i.length&&(r=r.slice(0,buffer.length));for(var o=0;o<i.length;o++)r.length<=o&&r.push(null),r[o]=i[o].buffer=e.decodeArrayBuffer(i[o].buffer,r[o]),a.push(i[o].buffer);switch(n.pixelFormatType){case"kCVPixelFormatType_420YpCbCr8BiPlanarFullRange":n.pixelFormat="YUV420P";break;default:n.pixelFormat=n.pixelFormatType}postMessage(t.data,a)})}.toString(),")()"],{type:"application/javascript"}))}},{key:"deviceId",get:function(){return this._deviceId}},{key:"isWatching",get:function(){return this._isWatching}},{key:"isInitialized",get:function(){return this._isInitialized}},{key:"hasData",get:function(){return null!==this._rawARData}}],[{key:"GetOrCreate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(void 0===t.GLOBAL_INSTANCE){t.GLOBAL_INSTANCE=new t,e=e&&"object"==(void 0===e?"undefined":l(e))?e:{};var n={browser:!0,points:!0,focus:!1,rec:!0,rec_time:!0,mic:!1,build:!1,plane:!0,warnings:!0,anchors:!1,debug:!0,statistics:!1},r="object"==l(e.ui)?e.ui:{};e.ui=Object.assign(n,r),t.GLOBAL_INSTANCE._sendInit(e)}return t.GLOBAL_INSTANCE}},{key:"HasARKit",value:function(){return void 0!==window.webkit}},{key:"removeAnchor",value:function(e){window.webkit.messageHandlers.removeAnchors.postMessage([e])}}]),t}(f.default);t.default=E,E.INIT_EVENT="arkit-init",E.WATCH_EVENT="arkit-watch",E.RECORD_START_EVENT="arkit-record-start",E.RECORD_STOP_EVENT="arkit-record-stop",E.DID_MOVE_BACKGROUND_EVENT="arkit-did-move-background",E.WILL_ENTER_FOREGROUND_EVENT="arkit-will-enter-foreground",E.INTERRUPTED_EVENT="arkit-interrupted",E.INTERRUPTION_ENDED_EVENT="arkit-interruption-ended",E.SHOW_DEBUG_EVENT="arkit-show-debug",E.WINDOW_RESIZE_EVENT="arkit-window-resize",E.ON_ERROR="on-error",E.AR_TRACKING_CHANGED="ar_tracking_changed",E.COMPUTER_VISION_DATA="cv_data",E.USER_GRANTED_COMPUTER_VISION_DATA="user-granted-cv-data",E.HIT_TEST_TYPE_FEATURE_POINT=1,E.HIT_TEST_TYPE_EXISTING_PLANE=8,E.HIT_TEST_TYPE_ESTIMATED_HORIZONTAL_PLANE=2,E.HIT_TEST_TYPE_EXISTING_PLANE_USING_EXTENT=16,E.HIT_TEST_TYPE_ALL=E.HIT_TEST_TYPE_FEATURE_POINT|E.HIT_TEST_TYPE_EXISTING_PLANE|E.HIT_TEST_TYPE_ESTIMATED_HORIZONTAL_PLANE|E.HIT_TEST_TYPE_EXISTING_PLANE_USING_EXTENT,E.HIT_TEST_TYPE_EXISTING_PLANES=E.HIT_TEST_TYPE_EXISTING_PLANE|E.HIT_TEST_TYPE_EXISTING_PLANE_USING_EXTENT},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e),this._ambientLightIntensity=1}return i(e,[{key:"getAmbientColorTemperature",value:function(){throw new Error("Not implemented")}},{key:"ambientIntensity",set:function(e){this._ambientLightIntensity=e/1e3},get:function(){return this._ambientLightIntensity}}]),e}();t.default=a},function(e,t,n){function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(0),s=r(o),u=n(1),l=r(u),c=n(4),h=(r(c),function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;i(this,e),this._anchorUID=t,this._poseMatrix=n||s.default.mat4_generateIdentity()}return a(e,[{key:"getOffsetTransform",value:function(e){return s.default.mat4_multiply(new Float32Array(16),this._poseMatrix,e._poseModelMatrix)}},{key:"anchorUID",get:function(){return this._anchorUID}},{key:"poseMatrix",get:function(){return this._poseMatrix},set:function(e){for(var t=0;t<16;t++)this._poseMatrix[t]=e[t]}},{key:"position",get:function(){return new Float32Array([this._poseMatrix[12],this._poseMatrix[13],this._poseMatrix[14]])}},{key:"orientation",get:function(){var e=new l.default;return e.setFromRotationMatrix(this._poseMatrix),e.toArray()}}]),e}());t.default=h},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t,n,i,a){r(this,e),this._x=t,this._y=n,this._width=i,this._height=a}return i(e,[{key:"x",get:function(){return this._x},set:function(e){this._x=e}},{key:"y",get:function(){return this._y},set:function(e){this._y=e}},{key:"width",get:function(){return this._width},set:function(e){this._width=e}},{key:"height",get:function(){return this._height},set:function(e){this._height=e}}]),e}();t.default=a},function(e,t,n){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=n(2),u=function(e){return e&&e.__esModule?e:{default:e}}(s),l=function(e){function t(){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),t}(u.default);t.default=l},function(e,t,n){function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(2),c=i(l),h=n(10),f=i(h),d=n(1),_=i(d),v=n(30),p=i(v),y=function(e){function t(){a(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._deviceOrientation=null,e._windowOrientation=0,window.addEventListener("orientationchange",function(){e._windowOrientation=window.orientation||0},!1),window.addEventListener("deviceorientation",function(n){e._deviceOrientation=n,e.dispatchEvent(new CustomEvent(t.ORIENTATION_UPDATE_EVENT,{deviceOrientation:e._deviceOrientation,windowOrientation:e._windowOrientation}))},!1),e}return s(t,e),u(t,[{key:"getOrientation",value:function(e){return null===this._deviceOrientation?(e.set(0,0,0,1),!1):(t.WORKING_EULER.set(this._deviceOrientation.beta*t.DEG_TO_RAD,this._deviceOrientation.alpha*t.DEG_TO_RAD,-1*this._deviceOrientation.gamma*t.DEG_TO_RAD,"YXZ"),e.setFromEuler(t.WORKING_EULER.x,t.WORKING_EULER.y,t.WORKING_EULER.z,t.WORKING_EULER.order),e.multiply(t.HALF_PI_AROUND_X),e.multiply(t.WORKING_QUATERNION.setFromAxisAngle(t.Z_AXIS,-this._windowOrientation*t.DEG_TO_RAD)),!0)}}]),t}(c.default);t.default=y,y.ORIENTATION_UPDATE_EVENT="orientation-update",y.Z_AXIS=new f.default(0,0,1),y.WORKING_EULER=new p.default,y.WORKING_QUATERNION=new _.default,y.HALF_PI_AROUND_X=new _.default(-Math.sqrt(.5),0,0,Math.sqrt(.5)),y.DEG_TO_RAD=Math.PI/180},function(e,t,n){function r(){var e=new z.ARRAY_TYPE(3);return e[0]=0,e[1]=0,e[2]=0,e}function i(e){var t=new z.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function a(e){var t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)}function o(e,t,n){var r=new z.ARRAY_TYPE(3);return r[0]=e,r[1]=t,r[2]=n,r}function s(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function u(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}function l(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function c(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function h(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function f(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function d(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function _(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function v(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}function p(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}function y(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function m(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function b(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}function w(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(n*n+r*r+i*i)}function g(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i}function E(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function M(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function x(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function T(e,t){var n=t[0],r=t[1],i=t[2],a=n*n+r*r+i*i;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a),e}function A(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function R(e,t,n){var r=t[0],i=t[1],a=t[2],o=n[0],s=n[1],u=n[2];return e[0]=i*u-a*s,e[1]=a*o-r*u,e[2]=r*s-i*o,e}function O(e,t,n,r){var i=t[0],a=t[1],o=t[2];return e[0]=i+r*(n[0]-i),e[1]=a+r*(n[1]-a),e[2]=o+r*(n[2]-o),e}function P(e,t,n,r,i,a){var o=a*a,s=o*(2*a-3)+1,u=o*(a-2)+a,l=o*(a-1),c=o*(3-2*a);return e[0]=t[0]*s+n[0]*u+r[0]*l+i[0]*c,e[1]=t[1]*s+n[1]*u+r[1]*l+i[1]*c,e[2]=t[2]*s+n[2]*u+r[2]*l+i[2]*c,e}function k(e,t,n,r,i,a){var o=1-a,s=o*o,u=a*a,l=s*o,c=3*a*s,h=3*u*o,f=u*a;return e[0]=t[0]*l+n[0]*c+r[0]*h+i[0]*f,e[1]=t[1]*l+n[1]*c+r[1]*h+i[1]*f,e[2]=t[2]*l+n[2]*c+r[2]*h+i[2]*f,e}function S(e,t){t=t||1;var n=2*z.RANDOM()*Math.PI,r=2*z.RANDOM()-1,i=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*i,e[1]=Math.sin(n)*i,e[2]=r*t,e}function I(e,t,n){var r=t[0],i=t[1],a=t[2],o=n[3]*r+n[7]*i+n[11]*a+n[15];return o=o||1,e[0]=(n[0]*r+n[4]*i+n[8]*a+n[12])/o,e[1]=(n[1]*r+n[5]*i+n[9]*a+n[13])/o,e[2]=(n[2]*r+n[6]*i+n[10]*a+n[14])/o,e}function N(e,t,n){var r=t[0],i=t[1],a=t[2];return e[0]=r*n[0]+i*n[3]+a*n[6],e[1]=r*n[1]+i*n[4]+a*n[7],e[2]=r*n[2]+i*n[5]+a*n[8],e}function C(e,t,n){var r=t[0],i=t[1],a=t[2],o=n[0],s=n[1],u=n[2],l=n[3],c=l*r+s*a-u*i,h=l*i+u*r-o*a,f=l*a+o*i-s*r,d=-o*r-s*i-u*a;return e[0]=c*l+d*-o+h*-u-f*-s,e[1]=h*l+d*-s+f*-o-c*-u,e[2]=f*l+d*-u+c*-s-h*-o,e}function D(e,t,n,r){var i=[],a=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],a[0]=i[0],a[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),a[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e}function L(e,t,n,r){var i=[],a=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],a[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),a[1]=i[1],a[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e}function j(e,t,n,r){var i=[],a=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],a[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),a[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),a[2]=i[2],e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e}function F(e,t){var n=o(e[0],e[1],e[2]),r=o(t[0],t[1],t[2]);T(n,n),T(r,r);var i=A(n,r);return i>1?0:i<-1?Math.PI:Math.acos(i)}function V(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function W(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function H(e,t){var n=e[0],r=e[1],i=e[2],a=t[0],o=t[1],s=t[2];return Math.abs(n-a)<=z.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-o)<=z.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-s)<=z.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))}Object.defineProperty(t,"__esModule",{value:!0}),t.forEach=t.sqrLen=t.len=t.sqrDist=t.dist=t.div=t.mul=t.sub=void 0,t.create=r,t.clone=i,t.length=a,t.fromValues=o,t.copy=s,t.set=u,t.add=l,t.subtract=c,t.multiply=h,t.divide=f,t.ceil=d,t.floor=_,t.min=v,t.max=p,t.round=y,t.scale=m,t.scaleAndAdd=b,t.distance=w,t.squaredDistance=g,t.squaredLength=E,t.negate=M,t.inverse=x,t.normalize=T,t.dot=A,t.cross=R,t.lerp=O,t.hermite=P,t.bezier=k,t.random=S,t.transformMat4=I,t.transformMat3=N,t.transformQuat=C,t.rotateX=D,t.rotateY=L,t.rotateZ=j,t.angle=F,t.str=V,t.exactEquals=W,t.equals=H;var X=n(3),z=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(X);t.sub=c,t.mul=h,t.div=f,t.dist=w,t.sqrDist=g,t.len=a,t.sqrLen=E,t.forEach=function(){var e=r();return function(t,n,r,i,a,o){var s=void 0,u=void 0;for(n||(n=3),r||(r=0),u=i?Math.min(i*n+r,t.length):t.length,s=r;s<u;s+=n)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],a(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2];return t}}()},function(e,t,n){function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(5),c=i(l),h=n(7),f=i(h),d=n(21),_=i(d),v=n(6),p=i(v),y=n(22),m=i(y),b=n(12),w=i(b),g=n(4),E=i(g),M=n(23),x=i(M),T=n(13),A=i(T),R=n(24),O=i(R),P=n(25),k=i(P),S=n(26),I=i(S),N=n(8),C=i(N),D=n(14),L=i(D),j=n(27),F=i(j),V=n(9),W=i(V),H=n(15),X=i(H),z=n(28),Y=i(z),U=n(2),G=i(U),q=n(29),B=i(q),K=n(36),Z=i(K),Q=n(37),J=i(Q),$=function(e){function t(){a(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));window.XRDisplay=c.default,window.XRSession=f.default,window.XRSessionCreateParameters=_.default,window.Reality=p.default,window.XRPointCloud=m.default,window.XRLightEstimate=w.default,window.XRAnchor=E.default,window.XRPlaneAnchor=x.default,window.XRAnchorOffset=A.default,window.XRStageBounds=O.default,window.XRStageBoundsPoint=k.default,window.XRPresentationFrame=I.default,window.XRView=C.default,window.XRViewport=L.default,window.XRCoordinateSystem=F.default,window.XRViewPose=W.default,window.XRLayer=X.default,window.XRWebGLLayer=Y.default,e._getVRDisplaysFinished=!1,e._sharedRealities=[new J.default(e)],e._privateRealities=[],e._displays=[new B.default(e,e._sharedRealities[0])],"function"==typeof navigator.getVRDisplays?navigator.getVRDisplays().then(function(t){var n=!0,r=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;null!==s&&(s.capabilities.canPresent&&e._displays.push(new Z.default(e,e._sharedRealities[0],s)))}}catch(e){r=!0,i=e}finally{try{!n&&o.return&&o.return()}finally{if(r)throw i}}e._getVRDisplaysFinished=!0}):e._getVRDisplaysFinished=!0,e._sessionEls=document.createElement("div"),e._sessionEls.setAttribute("class","webxr-sessions"),e._realityEls=document.createElement("div"),e._realityEls.setAttribute("class","webxr-realities");for(var n=[e._sessionEls,e._realityEls],r=0;r<n.length;r++){var i=n[r];i.style.position="absolute",i.style.width="100%",i.style.height="100%"}var s=function(){document.body.style.width="100%",document.body.style.height="100%",document.body.prepend(e._sessionEls),document.body.prepend(e._realityEls)};return"loading"!==document.readyState?s():document.addEventListener("DOMContentLoaded",s),e}return s(t,e),u(t,[{key:"getDisplays",value:function(){var e=this,t=function t(n){e._getVRDisplaysFinished?n(e._displays):setTimeout(t.bind(e,n),30)};return new Promise(function(e,n){t(e)})}}]),t}(G.default);void 0===navigator.XR&&(navigator.XR=new $)},function(e,t,n){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(6),l=function(e){return e&&e.__esModule?e:{default:e}}(u),c=function(e){function t(e){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"Virtual",!1,!1))}return o(t,e),s(t,[{key:"_start",value:function(e){}},{key:"_stop",value:function(){}},{key:"_handleNewFrame",value:function(){}},{key:"_addAnchor",value:function(e,t){return this._anchors.set(e.uid,e),e.uid}},{key:"_findAnchor",value:function(e,t,n){return new Promise(function(e,t){e(null)})}},{key:"_removeAnchor",value:function(e){this._anchors.delete(e)}},{key:"_hitTestNoAnchor",value:function(e,t,n){return null}},{key:"_getHasLightEstimate",value:function(){return!1}},{key:"_findFloorAnchor",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=new Float32Array(e._headPose.poseModelMatrix);return new Promise(function(i,a){r[13]=0;var o=new XRCoordinateSystem(e,XRCoordinateSystem.TRACKER);o._relativeMatrix=r;var s=new XRAnchor(o,n);t._addAnchor(s,e),i(new XRAnchorOffset(s.uid))})}}]),t}(l.default);t.default=c},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t,n,i,a){r(this,e),this._upDegrees=t,this._downDegrees=n,this._leftDegrees=i,this._rightDegrees=a}return i(e,[{key:"upDegrees",get:function(){return this._upDegrees}},{key:"downDegrees",get:function(){return this._downDegrees}},{key:"leftDegrees",get:function(){return this._leftDegrees}},{key:"rightDegrees",get:function(){return this._rightDegrees}}]),e}();t.default=a},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e)}return i(e,[{key:"exclusive",get:function(){throw"Not implemented"}},{key:"type",get:function(){throw"Not implemented"}}]),e}();t.default=a},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e)}return i(e,[{key:"points",get:function(){throw new Error("Not implemented")}}]),e}();t.default=a},function(e,t,n){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(4),l=function(e){return e&&e.__esModule?e:{default:e}}(u),c=function(e){function t(){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),s(t,[{key:"width",get:function(){throw"Not implemented"}},{key:"length",get:function(){throw"Not implemented"}}]),t}(l.default);t.default=c},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e)}return i(e,[{key:"center",get:function(){throw new Error("Not implemented")}},{key:"geometry",get:function(){throw new Error("Not implemented")}}]),e}();t.default=a},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e)}return i(e,[{key:"x",get:function(){throw new Error("Not implemented")}},{key:"y",get:function(){throw new Error("Not implemented")}}]),e}();t.default=a},function(e,t,n){function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(4),s=r(o),u=n(0),l=r(u),c=function(){function e(t){i(this,e),this._session=t}return a(e,[{key:"addAnchor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0,1],r=l.default.mat4_fromRotationTranslation(new Float32Array(16),n,t);l.default.mat4_multiply(r,e.getTransformTo(this._session._display._trackerCoordinateSystem),r);var i=new XRCoordinateSystem(this._session._display,XRCoordinateSystem.TRACKER);return i._relativeMatrix=r,this._session.reality._addAnchor(new s.default(i),this._session.display)}},{key:"findAnchor",value:function(e,t){return this._session.reality._findAnchor(e,t,this._session.display)}},{key:"hitTestNoAnchor",value:function(e,t){return this._session.reality._hitTestNoAnchor(e,t,this._session.display)}},{key:"findFloorAnchor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this._session.reality._findFloorAnchor(this._session.display,e)}},{key:"removeAnchor",value:function(e){return this._session.reality._removeAnchor(e)}},{key:"getAnchor",value:function(e){return this._session.reality._getAnchor(e)}},{key:"getCoordinateSystem",value:function(){var e;return(e=this._session)._getCoordinateSystem.apply(e,arguments)}},{key:"getDisplayPose",value:function(e){switch(e._type){case XRCoordinateSystem.HEAD_MODEL:return this._session._display._headPose;case XRCoordinateSystem.EYE_LEVEL:return this._session._display._eyeLevelPose;default:return null}}},{key:"session",get:function(){return this._session}},{key:"views",get:function(){return this._session._display._views}},{key:"hasPointCloud",get:function(){return!1}},{key:"pointCloud",get:function(){return null}},{key:"hasLightEstimate",get:function(){return this._session.reality._getHasLightEstimate()}},{key:"lightEstimate",get:function(){return this._session.reality._getLightAmbientIntensity()}},{key:"anchors",get:function(){var e=[],t=!0,n=!1,r=void 0;try{for(var i,a=this._session.reality._anchors.values()[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;e.push(o)}}catch(e){n=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}return e}}]),e}();t.default=c},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(0),o=function(e){return e&&e.__esModule?e:{default:e}}(a),s=function(){function e(t,n){r(this,e),this._display=t,this._type=n,this.__relativeMatrix=o.default.mat4_generateIdentity(),this._workingMatrix=o.default.mat4_generateIdentity()}return i(e,[{key:"getTransformTo",value:function(e){var t=o.default.mat4_invert(new Float32Array(16),e._poseModelMatrix),n=o.default.mat4_generateIdentity();return o.default.mat4_multiply(n,t,n),o.default.mat4_multiply(n,this._poseModelMatrix,n),n}},{key:"_relativeMatrix",get:function(){return this.__relativeMatrix},set:function(e){for(var t=0;t<16;t++)this.__relativeMatrix[t]=e[t]}},{key:"_poseModelMatrix",get:function(){switch(this._type){case e.HEAD_MODEL:return this._display._headPose.poseModelMatrix;case e.EYE_LEVEL:return this._display._eyeLevelPose.poseModelMatrix;case e.TRACKER:return o.default.mat4_multiply(this._workingMatrix,this.__relativeMatrix,this._display._trackerPoseModelMatrix),this._workingMatrix;default:throw new Error("Unknown coordinate system type: "+this._type)}}}]),e}();t.default=s,s.HEAD_MODEL="headModel",s.EYE_LEVEL="eyeLevel",s.TRACKER="tracker",s.TYPES=[s.HEAD_MODEL,s.EYE_LEVEL,s.TRACKER]},function(e,t,n){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(15),l=function(e){return e&&e.__esModule?e:{default:e}}(u),c=function(e){function t(e,n){i(this,t);var r=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._session=e,r._context=n,r._width=r._context.canvas.width,r._height=r._context.canvas.height,r._framebuffer=null,r}return o(t,e),s(t,[{key:"requestViewportScaling",value:function(e){throw"Not implemented"}},{key:"context",get:function(){return this._context}},{key:"antialias",get:function(){throw"Not implemented"}},{key:"depth",get:function(){throw"Not implemented"}},{key:"stencil",get:function(){throw"Not implemented"}},{key:"alpha",get:function(){throw"Not implemented"}},{key:"multiview",get:function(){throw"Not implemented"}},{key:"framebuffer",get:function(){return this._framebuffer}},{key:"framebufferWidth",set:function(e){this._width=e,this._context.canvas.width=e},get:function(){return this._width}},{key:"framebufferHeight",set:function(e){this._height=e,this._context.canvas.height=e},get:function(){return this._height}}]),t}(l.default);t.default=c},function(e,t,n){function i(e){return e&&e.__esModule?e:{default:e}}function a(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,r)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(r)},h=n(5),f=i(h),d=n(8),_=i(d),v=n(7),p=i(v),y=n(0),m=i(y),b=n(1),w=i(b),g=n(10),E=i(g),M=n(16),x=i(M),T=n(11),A=i(T),R=function(e){function t(e,n){o(this,t);var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"Flat",!1,n));return r._started=!1,r._initialized=!1,r._arKitWrapper=null,r._vrFrameData=null,r._deviceOrientationTracker=null,r._deviceOrientation=null,r._devicePosition=null,r._deviceWorldMatrix=null,r._views.push(new _.default(r._fov,r._depthNear,r._depthFar)),r}return u(t,e),l(t,[{key:"_start",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._reality._vrDisplay?null===this._vrFrameData&&(this._vrFrameData=new VRFrameData,this._views[0]._depthNear=this._reality._vrDisplay.depthNear,this._views[0]._depthFar=this._reality._vrDisplay.depthFar,this._deviceOrientation=new w.default,this._devicePosition=new E.default,this._deviceWorldMatrix=new Float32Array(16)):A.default.HasARKit()?!1===this._initialized&&(this._initialized=!0,this._arKitWrapper=A.default.GetOrCreate(),this._arKitWrapper.addEventListener(A.default.INIT_EVENT,this._handleARKitInit.bind(this)),this._arKitWrapper.addEventListener(A.default.WATCH_EVENT,this._handleARKitUpdate.bind(this)),this._arKitWrapper.addEventListener(A.default.WINDOW_RESIZE_EVENT,this._handleARKitWindowResize.bind(this)),this._arKitWrapper.addEventListener(A.default.ON_ERROR,this._handleOnError.bind(this)),this._arKitWrapper.addEventListener(A.default.AR_TRACKING_CHANGED,this._handleArTrackingChanged.bind(this)),this._arKitWrapper.addEventListener(A.default.COMPUTER_VISION_DATA,this._handleComputerVisionData.bind(this)),this._arKitWrapper.waitForInit().then(function(){})):!1===this._initialized&&(this._initialized=!0,this._deviceOrientation=new w.default,this._devicePosition=new E.default,this._deviceWorldMatrix=new Float32Array(16),this._deviceOrientationTracker=new x.default,this._deviceOrientationTracker.addEventListener(x.default.ORIENTATION_UPDATE_EVENT,this._updateFromDeviceOrientationTracker.bind(this))),this.running=!0,this._reality._start(e)}},{key:"_stop",value:function(){!1!==this.running&&(this.running=!1,this._reality._stop())}},{key:"_handleNewBaseLayer",value:function(e){this.baseLayer=e,e._context.canvas.style.width="100%",e._context.canvas.style.height="100%",e.framebufferWidth=this._xr._sessionEls.clientWidth,e.framebufferHeight=this._xr._sessionEls.clientHeight,null===this._arKitWrapper&&window.addEventListener("resize",function(){e.framebufferWidth=e._context.canvas.clientWidth,e.framebufferHeight=e._context.canvas.clientHeight},!1),this._xr._sessionEls.appendChild(e._context.canvas)}},{key:"_handleNewFrame",value:function(e){null!==this._vrFrameData&&this._updateFromVRDevice()}},{key:"_updateFromVRDevice",value:function(){var e,t;this._reality._vrDisplay.getFrameData(this._vrFrameData),this._views[0].setProjectionMatrix(this._vrFrameData.leftProjectionMatrix),(e=this._deviceOrientation).set.apply(e,a(this._vrFrameData.pose.orientation)),(t=this._devicePosition).set.apply(t,a(this._vrFrameData.pose.position)),this._devicePosition.add(0,XRViewPose.SITTING_EYE_HEIGHT,0),m.default.mat4_fromRotationTranslation(this._deviceWorldMatrix,this._deviceOrientation.toArray(),this._devicePosition.toArray()),this._headPose._setPoseModelMatrix(this._deviceWorldMatrix),this._eyeLevelPose._position=this._devicePosition.toArray()}},{key:"_updateFromDeviceOrientationTracker",value:function(){this._deviceOrientationTracker.getOrientation(this._deviceOrientation),this._devicePosition.set(this._headPose.poseModelMatrix[12],this._headPose.poseModelMatrix[13],this._headPose.poseModelMatrix[14]),this._devicePosition.add(0,XRViewPose.SITTING_EYE_HEIGHT,0),m.default.mat4_fromRotationTranslation(this._deviceWorldMatrix,this._deviceOrientation.toArray(),this._devicePosition.toArray()),this._headPose._setPoseModelMatrix(this._deviceWorldMatrix),this._eyeLevelPose._position=this._devicePosition.toArray()}},{key:"_handleARKitUpdate",value:function(){var e=this._arKitWrapper.getData("camera_transform");e?(this._headPose._setPoseModelMatrix(e),this._headPose._poseModelMatrix[13]+=XRViewPose.SITTING_EYE_HEIGHT,this._eyeLevelPose._position=this._headPose._position):console.log("no camera transform",this._arKitWrapper.rawARData);var t=this._arKitWrapper.getData("projection_camera");t?this._views[0].setProjectionMatrix(t):console.log("no projection camera",this._arKitWrapper.rawARData)}},{key:"_handleARKitInit",value:function(e){}},{key:"_handleARKitWindowResize",value:function(e){this.baseLayer.framebufferWidth=e.detail.width,this.baseLayer.framebufferHeight=e.detail.height}},{key:"_handleOnError",value:function(e){}},{key:"_handleArTrackingChanged",value:function(e){}},{key:"_handleComputerVisionData",value:function(e){try{this.dispatchEvent(new CustomEvent("videoFrame",{source:this,detail:e.detail}))}catch(e){console.error("computer vision callback error",e)}}},{key:"_requestVideoFrame",value:function(e){this._arKitWrapper._requestComputerVisionData(e)}},{key:"_createSession",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this._start(e),c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_createSession",this).call(this,e)}},{key:"_supportedCreationParameters",value:function(e){return e.type===p.default.AUGMENTATION&&!1===e.exclusive}}]),t}(f.default);t.default=R},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t,n,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.DefaultOrder;r(this,e),this.x=t,this.y=n,this.z=i,this.order=a}return i(e,[{key:"set",value:function(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.DefaultOrder;this.x=t,this.y=n,this.z=r,this.order=i}},{key:"toArray",value:function(){return[this.x,this.y,this.z]}}]),e}();t.default=a,a.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],a.DefaultOrder="XYZ"},function(e,t,n){function r(){var e=new B.ARRAY_TYPE(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function i(e){var t=new B.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function a(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function o(e,t,n,r,i,a,o,s,u,l,c,h,f,d,_,v){var p=new B.ARRAY_TYPE(16);return p[0]=e,p[1]=t,p[2]=n,p[3]=r,p[4]=i,p[5]=a,p[6]=o,p[7]=s,p[8]=u,p[9]=l,p[10]=c,p[11]=h,p[12]=f,p[13]=d,p[14]=_,p[15]=v,p}function s(e,t,n,r,i,a,o,s,u,l,c,h,f,d,_,v,p){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=a,e[5]=o,e[6]=s,e[7]=u,e[8]=l,e[9]=c,e[10]=h,e[11]=f,e[12]=d,e[13]=_,e[14]=v,e[15]=p,e}function u(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function l(e,t){if(e===t){var n=t[1],r=t[2],i=t[3],a=t[6],o=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=a,e[11]=t[14],e[12]=i,e[13]=o,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function c(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=t[9],f=t[10],d=t[11],_=t[12],v=t[13],p=t[14],y=t[15],m=n*s-r*o,b=n*u-i*o,w=n*l-a*o,g=r*u-i*s,E=r*l-a*s,M=i*l-a*u,x=c*v-h*_,T=c*p-f*_,A=c*y-d*_,R=h*p-f*v,O=h*y-d*v,P=f*y-d*p,k=m*P-b*O+w*R+g*A-E*T+M*x;return k?(k=1/k,e[0]=(s*P-u*O+l*R)*k,e[1]=(i*O-r*P-a*R)*k,e[2]=(v*M-p*E+y*g)*k,e[3]=(f*E-h*M-d*g)*k,e[4]=(u*A-o*P-l*T)*k,e[5]=(n*P-i*A+a*T)*k,e[6]=(p*w-_*M-y*b)*k,e[7]=(c*M-f*w+d*b)*k,e[8]=(o*O-s*A+l*x)*k,e[9]=(r*A-n*O-a*x)*k,e[10]=(_*E-v*w+y*m)*k,e[11]=(h*w-c*E-d*m)*k,e[12]=(s*T-o*R-u*x)*k,e[13]=(n*R-r*T+i*x)*k,e[14]=(v*b-_*g-p*m)*k,e[15]=(c*g-h*b+f*m)*k,e):null}function h(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=t[9],f=t[10],d=t[11],_=t[12],v=t[13],p=t[14],y=t[15];return e[0]=s*(f*y-d*p)-h*(u*y-l*p)+v*(u*d-l*f),e[1]=-(r*(f*y-d*p)-h*(i*y-a*p)+v*(i*d-a*f)),e[2]=r*(u*y-l*p)-s*(i*y-a*p)+v*(i*l-a*u),e[3]=-(r*(u*d-l*f)-s*(i*d-a*f)+h*(i*l-a*u)),e[4]=-(o*(f*y-d*p)-c*(u*y-l*p)+_*(u*d-l*f)),e[5]=n*(f*y-d*p)-c*(i*y-a*p)+_*(i*d-a*f),e[6]=-(n*(u*y-l*p)-o*(i*y-a*p)+_*(i*l-a*u)),e[7]=n*(u*d-l*f)-o*(i*d-a*f)+c*(i*l-a*u),e[8]=o*(h*y-d*v)-c*(s*y-l*v)+_*(s*d-l*h),e[9]=-(n*(h*y-d*v)-c*(r*y-a*v)+_*(r*d-a*h)),e[10]=n*(s*y-l*v)-o*(r*y-a*v)+_*(r*l-a*s),e[11]=-(n*(s*d-l*h)-o*(r*d-a*h)+c*(r*l-a*s)),e[12]=-(o*(h*p-f*v)-c*(s*p-u*v)+_*(s*f-u*h)),e[13]=n*(h*p-f*v)-c*(r*p-i*v)+_*(r*f-i*h),e[14]=-(n*(s*p-u*v)-o*(r*p-i*v)+_*(r*u-i*s)),e[15]=n*(s*f-u*h)-o*(r*f-i*h)+c*(r*u-i*s),e}function f(e){var t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],f=e[11],d=e[12],_=e[13],v=e[14],p=e[15];return(t*o-n*a)*(h*p-f*v)-(t*s-r*a)*(c*p-f*_)+(t*u-i*a)*(c*v-h*_)+(n*s-r*o)*(l*p-f*d)-(n*u-i*o)*(l*v-h*d)+(r*u-i*s)*(l*_-c*d)}function d(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],f=t[9],d=t[10],_=t[11],v=t[12],p=t[13],y=t[14],m=t[15],b=n[0],w=n[1],g=n[2],E=n[3];return e[0]=b*r+w*s+g*h+E*v,e[1]=b*i+w*u+g*f+E*p,e[2]=b*a+w*l+g*d+E*y,e[3]=b*o+w*c+g*_+E*m,b=n[4],w=n[5],g=n[6],E=n[7],e[4]=b*r+w*s+g*h+E*v,e[5]=b*i+w*u+g*f+E*p,e[6]=b*a+w*l+g*d+E*y,e[7]=b*o+w*c+g*_+E*m,b=n[8],w=n[9],g=n[10],E=n[11],e[8]=b*r+w*s+g*h+E*v,e[9]=b*i+w*u+g*f+E*p,e[10]=b*a+w*l+g*d+E*y,e[11]=b*o+w*c+g*_+E*m,b=n[12],w=n[13],g=n[14],E=n[15],e[12]=b*r+w*s+g*h+E*v,e[13]=b*i+w*u+g*f+E*p,e[14]=b*a+w*l+g*d+E*y,e[15]=b*o+w*c+g*_+E*m,e}function _(e,t,n){var r=n[0],i=n[1],a=n[2],o=void 0,s=void 0,u=void 0,l=void 0,c=void 0,h=void 0,f=void 0,d=void 0,_=void 0,v=void 0,p=void 0,y=void 0;return t===e?(e[12]=t[0]*r+t[4]*i+t[8]*a+t[12],e[13]=t[1]*r+t[5]*i+t[9]*a+t[13],e[14]=t[2]*r+t[6]*i+t[10]*a+t[14],e[15]=t[3]*r+t[7]*i+t[11]*a+t[15]):(o=t[0],s=t[1],u=t[2],l=t[3],c=t[4],h=t[5],f=t[6],d=t[7],_=t[8],v=t[9],p=t[10],y=t[11],e[0]=o,e[1]=s,e[2]=u,e[3]=l,e[4]=c,e[5]=h,e[6]=f,e[7]=d,e[8]=_,e[9]=v,e[10]=p,e[11]=y,e[12]=o*r+c*i+_*a+t[12],e[13]=s*r+h*i+v*a+t[13],e[14]=u*r+f*i+p*a+t[14],e[15]=l*r+d*i+y*a+t[15]),e}function v(e,t,n){var r=n[0],i=n[1],a=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function p(e,t,n,r){var i=r[0],a=r[1],o=r[2],s=Math.sqrt(i*i+a*a+o*o),u=void 0,l=void 0,c=void 0,h=void 0,f=void 0,d=void 0,_=void 0,v=void 0,p=void 0,y=void 0,m=void 0,b=void 0,w=void 0,g=void 0,E=void 0,M=void 0,x=void 0,T=void 0,A=void 0,R=void 0,O=void 0,P=void 0,k=void 0,S=void 0;return Math.abs(s)<B.EPSILON?null:(s=1/s,i*=s,a*=s,o*=s,u=Math.sin(n),l=Math.cos(n),c=1-l,h=t[0],f=t[1],d=t[2],_=t[3],v=t[4],p=t[5],y=t[6],m=t[7],b=t[8],w=t[9],g=t[10],E=t[11],M=i*i*c+l,x=a*i*c+o*u,T=o*i*c-a*u,A=i*a*c-o*u,R=a*a*c+l,O=o*a*c+i*u,P=i*o*c+a*u,k=a*o*c-i*u,S=o*o*c+l,e[0]=h*M+v*x+b*T,e[1]=f*M+p*x+w*T,e[2]=d*M+y*x+g*T,e[3]=_*M+m*x+E*T,e[4]=h*A+v*R+b*O,e[5]=f*A+p*R+w*O,e[6]=d*A+y*R+g*O,e[7]=_*A+m*R+E*O,e[8]=h*P+v*k+b*S,e[9]=f*P+p*k+w*S,e[10]=d*P+y*k+g*S,e[11]=_*P+m*k+E*S,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function y(e,t,n){var r=Math.sin(n),i=Math.cos(n),a=t[4],o=t[5],s=t[6],u=t[7],l=t[8],c=t[9],h=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*i+l*r,e[5]=o*i+c*r,e[6]=s*i+h*r,e[7]=u*i+f*r,e[8]=l*i-a*r,e[9]=c*i-o*r,e[10]=h*i-s*r,e[11]=f*i-u*r,e}function m(e,t,n){var r=Math.sin(n),i=Math.cos(n),a=t[0],o=t[1],s=t[2],u=t[3],l=t[8],c=t[9],h=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i-l*r,e[1]=o*i-c*r,e[2]=s*i-h*r,e[3]=u*i-f*r,e[8]=a*r+l*i,e[9]=o*r+c*i,e[10]=s*r+h*i,e[11]=u*r+f*i,e}function b(e,t,n){var r=Math.sin(n),i=Math.cos(n),a=t[0],o=t[1],s=t[2],u=t[3],l=t[4],c=t[5],h=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i+l*r,e[1]=o*i+c*r,e[2]=s*i+h*r,e[3]=u*i+f*r,e[4]=l*i-a*r,e[5]=c*i-o*r,e[6]=h*i-s*r,e[7]=f*i-u*r,e}function w(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function g(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function E(e,t,n){var r=n[0],i=n[1],a=n[2],o=Math.sqrt(r*r+i*i+a*a),s=void 0,u=void 0,l=void 0;return Math.abs(o)<B.EPSILON?null:(o=1/o,r*=o,i*=o,a*=o,s=Math.sin(t),u=Math.cos(t),l=1-u,e[0]=r*r*l+u,e[1]=i*r*l+a*s,e[2]=a*r*l-i*s,e[3]=0,e[4]=r*i*l-a*s,e[5]=i*i*l+u,e[6]=a*i*l+r*s,e[7]=0,e[8]=r*a*l+i*s,e[9]=i*a*l-r*s,e[10]=a*a*l+u,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function M(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function x(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function T(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function A(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=r+r,u=i+i,l=a+a,c=r*s,h=r*u,f=r*l,d=i*u,_=i*l,v=a*l,p=o*s,y=o*u,m=o*l;return e[0]=1-(d+v),e[1]=h+m,e[2]=f-y,e[3]=0,e[4]=h-m,e[5]=1-(c+v),e[6]=_+p,e[7]=0,e[8]=f+y,e[9]=_-p,e[10]=1-(c+d),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function R(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function O(e,t){var n=t[0],r=t[1],i=t[2],a=t[4],o=t[5],s=t[6],u=t[8],l=t[9],c=t[10];return e[0]=Math.sqrt(n*n+r*r+i*i),e[1]=Math.sqrt(a*a+o*o+s*s),e[2]=Math.sqrt(u*u+l*l+c*c),e}function P(e,t){var n=t[0]+t[5]+t[10],r=0;return n>0?(r=2*Math.sqrt(n+1),e[3]=.25*r,e[0]=(t[6]-t[9])/r,e[1]=(t[8]-t[2])/r,e[2]=(t[1]-t[4])/r):t[0]>t[5]&t[0]>t[10]?(r=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/r,e[0]=.25*r,e[1]=(t[1]+t[4])/r,e[2]=(t[8]+t[2])/r):t[5]>t[10]?(r=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/r,e[0]=(t[1]+t[4])/r,e[1]=.25*r,e[2]=(t[6]+t[9])/r):(r=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/r,e[0]=(t[8]+t[2])/r,e[1]=(t[6]+t[9])/r,e[2]=.25*r),e}function k(e,t,n,r){var i=t[0],a=t[1],o=t[2],s=t[3],u=i+i,l=a+a,c=o+o,h=i*u,f=i*l,d=i*c,_=a*l,v=a*c,p=o*c,y=s*u,m=s*l,b=s*c,w=r[0],g=r[1],E=r[2];return e[0]=(1-(_+p))*w,e[1]=(f+b)*w,e[2]=(d-m)*w,e[3]=0,e[4]=(f-b)*g,e[5]=(1-(h+p))*g,e[6]=(v+y)*g,e[7]=0,e[8]=(d+m)*E,e[9]=(v-y)*E,e[10]=(1-(h+_))*E,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function S(e,t,n,r,i){var a=t[0],o=t[1],s=t[2],u=t[3],l=a+a,c=o+o,h=s+s,f=a*l,d=a*c,_=a*h,v=o*c,p=o*h,y=s*h,m=u*l,b=u*c,w=u*h,g=r[0],E=r[1],M=r[2],x=i[0],T=i[1],A=i[2];return e[0]=(1-(v+y))*g,e[1]=(d+w)*g,e[2]=(_-b)*g,e[3]=0,e[4]=(d-w)*E,e[5]=(1-(f+y))*E,e[6]=(p+m)*E,e[7]=0,e[8]=(_+b)*M,e[9]=(p-m)*M,e[10]=(1-(f+v))*M,e[11]=0,e[12]=n[0]+x-(e[0]*x+e[4]*T+e[8]*A),e[13]=n[1]+T-(e[1]*x+e[5]*T+e[9]*A),e[14]=n[2]+A-(e[2]*x+e[6]*T+e[10]*A),e[15]=1,e}function I(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=n+n,s=r+r,u=i+i,l=n*o,c=r*o,h=r*s,f=i*o,d=i*s,_=i*u,v=a*o,p=a*s,y=a*u;return e[0]=1-h-_,e[1]=c+y,e[2]=f-p,e[3]=0,e[4]=c-y,e[5]=1-l-_,e[6]=d+v,e[7]=0,e[8]=f+p,e[9]=d-v,e[10]=1-l-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function N(e,t,n,r,i,a,o){var s=1/(n-t),u=1/(i-r),l=1/(a-o);return e[0]=2*a*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*u,e[6]=0,e[7]=0,e[8]=(n+t)*s,e[9]=(i+r)*u,e[10]=(o+a)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*a*2*l,e[15]=0,e}function C(e,t,n,r,i){var a=1/Math.tan(t/2),o=1/(r-i);return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(i+r)*o,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*i*r*o,e[15]=0,e}function D(e,t,n,r){var i=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),u=2/(o+s),l=2/(i+a);return e[0]=u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=-(o-s)*u*.5,e[9]=(i-a)*l*.5,e[10]=r/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*n/(n-r),e[15]=0,e}function L(e,t,n,r,i,a,o){var s=1/(t-n),u=1/(r-i),l=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+n)*s,e[13]=(i+r)*u,e[14]=(o+a)*l,e[15]=1,e}function j(e,t,n,r){var i=void 0,a=void 0,o=void 0,s=void 0,l=void 0,c=void 0,h=void 0,f=void 0,d=void 0,_=void 0,v=t[0],p=t[1],y=t[2],m=r[0],b=r[1],w=r[2],g=n[0],E=n[1],M=n[2];return Math.abs(v-g)<B.EPSILON&&Math.abs(p-E)<B.EPSILON&&Math.abs(y-M)<B.EPSILON?u(e):(h=v-g,f=p-E,d=y-M,_=1/Math.sqrt(h*h+f*f+d*d),h*=_,f*=_,d*=_,i=b*d-w*f,a=w*h-m*d,o=m*f-b*h,_=Math.sqrt(i*i+a*a+o*o),_?(_=1/_,i*=_,a*=_,o*=_):(i=0,a=0,o=0),s=f*o-d*a,l=d*i-h*o,c=h*a-f*i,_=Math.sqrt(s*s+l*l+c*c),_?(_=1/_,s*=_,l*=_,c*=_):(s=0,l=0,c=0),e[0]=i,e[1]=s,e[2]=h,e[3]=0,e[4]=a,e[5]=l,e[6]=f,e[7]=0,e[8]=o,e[9]=c,e[10]=d,e[11]=0,e[12]=-(i*v+a*p+o*y),e[13]=-(s*v+l*p+c*y),e[14]=-(h*v+f*p+d*y),e[15]=1,e)}function F(e,t,n,r){var i=t[0],a=t[1],o=t[2],s=r[0],u=r[1],l=r[2],c=i-n[0],h=a-n[1],f=o-n[2],d=c*c+h*h+f*f;d>0&&(d=1/Math.sqrt(d),c*=d,h*=d,f*=d);var _=u*f-l*h,v=l*c-s*f,p=s*h-u*c;return e[0]=_,e[1]=v,e[2]=p,e[3]=0,e[4]=h*p-f*v,e[5]=f*_-c*p,e[6]=c*v-h*_,e[7]=0,e[8]=c,e[9]=h,e[10]=f,e[11]=0,e[12]=i,e[13]=a,e[14]=o,e[15]=1,e}function V(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function W(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))}function H(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e}function X(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}function z(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e}function Y(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e[9]=t[9]+n[9]*r,e[10]=t[10]+n[10]*r,e[11]=t[11]+n[11]*r,e[12]=t[12]+n[12]*r,e[13]=t[13]+n[13]*r,e[14]=t[14]+n[14]*r,e[15]=t[15]+n[15]*r,e}function U(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function G(e,t){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],f=e[10],d=e[11],_=e[12],v=e[13],p=e[14],y=e[15],m=t[0],b=t[1],w=t[2],g=t[3],E=t[4],M=t[5],x=t[6],T=t[7],A=t[8],R=t[9],O=t[10],P=t[11],k=t[12],S=t[13],I=t[14],N=t[15];return Math.abs(n-m)<=B.EPSILON*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(r-b)<=B.EPSILON*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(i-w)<=B.EPSILON*Math.max(1,Math.abs(i),Math.abs(w))&&Math.abs(a-g)<=B.EPSILON*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(o-E)<=B.EPSILON*Math.max(1,Math.abs(o),Math.abs(E))&&Math.abs(s-M)<=B.EPSILON*Math.max(1,Math.abs(s),Math.abs(M))&&Math.abs(u-x)<=B.EPSILON*Math.max(1,Math.abs(u),Math.abs(x))&&Math.abs(l-T)<=B.EPSILON*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(c-A)<=B.EPSILON*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(h-R)<=B.EPSILON*Math.max(1,Math.abs(h),Math.abs(R))&&Math.abs(f-O)<=B.EPSILON*Math.max(1,Math.abs(f),Math.abs(O))&&Math.abs(d-P)<=B.EPSILON*Math.max(1,Math.abs(d),Math.abs(P))&&Math.abs(_-k)<=B.EPSILON*Math.max(1,Math.abs(_),Math.abs(k))&&Math.abs(v-S)<=B.EPSILON*Math.max(1,Math.abs(v),Math.abs(S))&&Math.abs(p-I)<=B.EPSILON*Math.max(1,Math.abs(p),Math.abs(I))&&Math.abs(y-N)<=B.EPSILON*Math.max(1,Math.abs(y),Math.abs(N))}Object.defineProperty(t,"__esModule",{value:!0}),t.sub=t.mul=void 0,t.create=r,t.clone=i,t.copy=a,t.fromValues=o,t.set=s,t.identity=u,t.transpose=l,t.invert=c,t.adjoint=h,t.determinant=f,t.multiply=d,t.translate=_,t.scale=v,t.rotate=p,t.rotateX=y,t.rotateY=m,t.rotateZ=b,t.fromTranslation=w,t.fromScaling=g,t.fromRotation=E,t.fromXRotation=M,t.fromYRotation=x,t.fromZRotation=T,t.fromRotationTranslation=A,t.getTranslation=R,t.getScaling=O,t.getRotation=P,t.fromRotationTranslationScale=k,t.fromRotationTranslationScaleOrigin=S,t.fromQuat=I,t.frustum=N,t.perspective=C,t.perspectiveFromFieldOfView=D,t.ortho=L,t.lookAt=j,t.targetTo=F,t.str=V,t.frob=W,t.add=H,t.subtract=X,t.multiplyScalar=z,t.multiplyScalarAndAdd=Y,t.exactEquals=U,t.equals=G;var q=n(3),B=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(q);t.mul=d,t.sub=X},function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(){var e=new w.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function a(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function o(e,t,n){n*=.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e}function s(e,t){var n=2*Math.acos(t[3]),r=Math.sin(n/2);return 0!=r?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),n}function u(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=n[0],u=n[1],l=n[2],c=n[3];return e[0]=r*c+o*s+i*l-a*u,e[1]=i*c+o*u+a*s-r*l,e[2]=a*c+o*l+r*u-i*s,e[3]=o*c-r*s-i*u-a*l,e}function l(e,t,n){n*=.5;var r=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(n),u=Math.cos(n);return e[0]=r*u+o*s,e[1]=i*u+a*s,e[2]=a*u-i*s,e[3]=o*u-r*s,e}function c(e,t,n){n*=.5;var r=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(n),u=Math.cos(n);return e[0]=r*u-a*s,e[1]=i*u+o*s,e[2]=a*u+r*s,e[3]=o*u-i*s,e}function h(e,t,n){n*=.5;var r=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(n),u=Math.cos(n);return e[0]=r*u+i*s,e[1]=i*u-r*s,e[2]=a*u+o*s,e[3]=o*u-a*s,e}function f(e,t){var n=t[0],r=t[1],i=t[2];return e[0]=n,e[1]=r,e[2]=i,e[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i)),e}function d(e,t,n,r){var i=t[0],a=t[1],o=t[2],s=t[3],u=n[0],l=n[1],c=n[2],h=n[3],f=void 0,d=void 0,_=void 0,v=void 0,p=void 0;return d=i*u+a*l+o*c+s*h,d<0&&(d=-d,u=-u,l=-l,c=-c,h=-h),1-d>1e-6?(f=Math.acos(d),_=Math.sin(f),v=Math.sin((1-r)*f)/_,p=Math.sin(r*f)/_):(v=1-r,p=r),e[0]=v*i+p*u,e[1]=v*a+p*l,e[2]=v*o+p*c,e[3]=v*s+p*h,e}function _(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=n*n+r*r+i*i+a*a,s=o?1/o:0;return e[0]=-n*s,e[1]=-r*s,e[2]=-i*s,e[3]=a*s,e}function v(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function p(e,t){var n=t[0]+t[4]+t[8],r=void 0;if(n>0)r=Math.sqrt(n+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);var a=(i+1)%3,o=(i+2)%3;r=Math.sqrt(t[3*i+i]-t[3*a+a]-t[3*o+o]+1),e[i]=.5*r,r=.5/r,e[3]=(t[3*a+o]-t[3*o+a])*r,e[a]=(t[3*a+i]+t[3*i+a])*r,e[o]=(t[3*o+i]+t[3*i+o])*r}return e}function y(e,t,n,r){var i=.5*Math.PI/180;t*=i,n*=i,r*=i;var a=Math.sin(t),o=Math.cos(t),s=Math.sin(n),u=Math.cos(n),l=Math.sin(r),c=Math.cos(r);return e[0]=a*u*c-o*s*l,e[1]=o*s*c+a*u*l,e[2]=o*u*l-a*s*c,e[3]=o*u*c+a*s*l,e}function m(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}Object.defineProperty(t,"__esModule",{value:!0}),t.setAxes=t.sqlerp=t.rotationTo=t.equals=t.exactEquals=t.normalize=t.sqrLen=t.squaredLength=t.len=t.length=t.lerp=t.dot=t.scale=t.mul=t.add=t.set=t.copy=t.fromValues=t.clone=void 0,t.create=i,t.identity=a,t.setAxisAngle=o,t.getAxisAngle=s,t.multiply=u,t.rotateX=l,t.rotateY=c,t.rotateZ=h,t.calculateW=f,t.slerp=d,t.invert=_,t.conjugate=v,t.fromMat3=p,t.fromEuler=y,t.str=m;var b=n(3),w=r(b),g=n(33),E=r(g),M=n(17),x=r(M),T=n(34),A=r(T),R=(t.clone=A.clone,t.fromValues=A.fromValues,t.copy=A.copy,t.set=A.set,t.add=A.add,t.mul=u,t.scale=A.scale,t.dot=A.dot,t.lerp=A.lerp,t.length=A.length),O=(t.len=R,t.squaredLength=A.squaredLength),P=(t.sqrLen=O,t.normalize=A.normalize);t.exactEquals=A.exactEquals,t.equals=A.equals,t.rotationTo=function(){var e=x.create(),t=x.fromValues(1,0,0),n=x.fromValues(0,1,0);return function(r,i,a){var s=x.dot(i,a);return s<-.999999?(x.cross(e,t,i),x.len(e)<1e-6&&x.cross(e,n,i),x.normalize(e,e),o(r,e,Math.PI),r):s>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(x.cross(e,i,a),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+s,P(r,r))}}(),t.sqlerp=function(){var e=i(),t=i();return function(n,r,i,a,o,s){return d(e,r,o,s),d(t,i,a,s),d(n,e,t,2*s*(1-s)),n}}(),t.setAxes=function(){var e=E.create();return function(t,n,r,i){return e[0]=r[0],e[3]=r[1],e[6]=r[2],e[1]=i[0],e[4]=i[1],e[7]=i[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],P(t,p(t,e))}}()},function(e,t,n){function r(){var e=new C.ARRAY_TYPE(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function i(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function a(e){var t=new C.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function o(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function s(e,t,n,r,i,a,o,s,u){var l=new C.ARRAY_TYPE(9);return l[0]=e,l[1]=t,l[2]=n,l[3]=r,l[4]=i,l[5]=a,l[6]=o,l[7]=s,l[8]=u,l}function u(e,t,n,r,i,a,o,s,u,l){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=a,e[5]=o,e[6]=s,e[7]=u,e[8]=l,e}function l(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function c(e,t){if(e===t){var n=t[1],r=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=r,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function h(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=c*o-s*l,f=-c*a+s*u,d=l*a-o*u,_=n*h+r*f+i*d;return _?(_=1/_,e[0]=h*_,e[1]=(-c*r+i*l)*_,e[2]=(s*r-i*o)*_,e[3]=f*_,e[4]=(c*n-i*u)*_,e[5]=(-s*n+i*a)*_,e[6]=d*_,e[7]=(-l*n+r*u)*_,e[8]=(o*n-r*a)*_,e):null}function f(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8];return e[0]=o*c-s*l,e[1]=i*l-r*c,e[2]=r*s-i*o,e[3]=s*u-a*c,e[4]=n*c-i*u,e[5]=i*a-n*s,e[6]=a*l-o*u,e[7]=r*u-n*l,e[8]=n*o-r*a,e}function d(e){var t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],u=e[7],l=e[8];return t*(l*a-o*u)+n*(-l*i+o*s)+r*(u*i-a*s)}function _(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],f=n[0],d=n[1],_=n[2],v=n[3],p=n[4],y=n[5],m=n[6],b=n[7],w=n[8];return e[0]=f*r+d*o+_*l,e[1]=f*i+d*s+_*c,e[2]=f*a+d*u+_*h,e[3]=v*r+p*o+y*l,e[4]=v*i+p*s+y*c,e[5]=v*a+p*u+y*h,e[6]=m*r+b*o+w*l,e[7]=m*i+b*s+w*c,e[8]=m*a+b*u+w*h,e}function v(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],f=n[0],d=n[1];return e[0]=r,e[1]=i,e[2]=a,e[3]=o,e[4]=s,e[5]=u,e[6]=f*r+d*o+l,e[7]=f*i+d*s+c,e[8]=f*a+d*u+h,e}function p(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],f=Math.sin(n),d=Math.cos(n);return e[0]=d*r+f*o,e[1]=d*i+f*s,e[2]=d*a+f*u,e[3]=d*o-f*r,e[4]=d*s-f*i,e[5]=d*u-f*a,e[6]=l,e[7]=c,e[8]=h,e}function y(e,t,n){var r=n[0],i=n[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function m(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function b(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=-n,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function w(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function g(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function E(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=n+n,s=r+r,u=i+i,l=n*o,c=r*o,h=r*s,f=i*o,d=i*s,_=i*u,v=a*o,p=a*s,y=a*u;return e[0]=1-h-_,e[3]=c-y,e[6]=f+p,e[1]=c+y,e[4]=1-l-_,e[7]=d-v,e[2]=f-p,e[5]=d+v,e[8]=1-l-h,e}function M(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=t[9],f=t[10],d=t[11],_=t[12],v=t[13],p=t[14],y=t[15],m=n*s-r*o,b=n*u-i*o,w=n*l-a*o,g=r*u-i*s,E=r*l-a*s,M=i*l-a*u,x=c*v-h*_,T=c*p-f*_,A=c*y-d*_,R=h*p-f*v,O=h*y-d*v,P=f*y-d*p,k=m*P-b*O+w*R+g*A-E*T+M*x;return k?(k=1/k,e[0]=(s*P-u*O+l*R)*k,e[1]=(u*A-o*P-l*T)*k,e[2]=(o*O-s*A+l*x)*k,e[3]=(i*O-r*P-a*R)*k,e[4]=(n*P-i*A+a*T)*k,e[5]=(r*A-n*O-a*x)*k,e[6]=(v*M-p*E+y*g)*k,e[7]=(p*w-_*M-y*b)*k,e[8]=(_*E-v*w+y*m)*k,e):null}function x(e,t,n){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/n,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function T(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function A(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))}function R(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e}function O(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e}function P(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e}function k(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e}function S(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function I(e,t){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=t[0],f=t[1],d=t[2],_=t[3],v=t[4],p=t[5],y=t[6],m=t[7],b=t[8];return Math.abs(n-h)<=C.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(r-f)<=C.EPSILON*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(i-d)<=C.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(a-_)<=C.EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(o-v)<=C.EPSILON*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(s-p)<=C.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(u-y)<=C.EPSILON*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(l-m)<=C.EPSILON*Math.max(1,Math.abs(l),Math.abs(m))&&Math.abs(c-b)<=C.EPSILON*Math.max(1,Math.abs(c),Math.abs(b))}Object.defineProperty(t,"__esModule",{value:!0}),t.sub=t.mul=void 0,t.create=r,t.fromMat4=i,t.clone=a,t.copy=o,t.fromValues=s,t.set=u,t.identity=l,t.transpose=c,t.invert=h,t.adjoint=f,t.determinant=d,t.multiply=_,t.translate=v,t.rotate=p,t.scale=y,t.fromTranslation=m,t.fromRotation=b,t.fromScaling=w,t.fromMat2d=g,t.fromQuat=E,t.normalFromMat4=M,t.projection=x,t.str=T,t.frob=A,t.add=R,t.subtract=O,t.multiplyScalar=P,t.multiplyScalarAndAdd=k,t.exactEquals=S,t.equals=I;var N=n(3),C=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(N);t.mul=_,t.sub=O},function(e,t,n){function r(){var e=new D.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function i(e){var t=new D.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function a(e,t,n,r){var i=new D.ARRAY_TYPE(4);return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i}function o(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function s(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e}function u(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e}function l(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}function c(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e}function h(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e}function f(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function d(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function _(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e}function v(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e}function p(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function y(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function m(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e}function b(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return Math.sqrt(n*n+r*r+i*i+a*a)}function w(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return n*n+r*r+i*i+a*a}function g(e){var t=e[0],n=e[1],r=e[2],i=e[3];return Math.sqrt(t*t+n*n+r*r+i*i)}function E(e){var t=e[0],n=e[1],r=e[2],i=e[3];return t*t+n*n+r*r+i*i}function M(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function x(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function T(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=n*n+r*r+i*i+a*a;return o>0&&(o=1/Math.sqrt(o),e[0]=n*o,e[1]=r*o,e[2]=i*o,e[3]=a*o),e}function A(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function R(e,t,n,r){var i=t[0],a=t[1],o=t[2],s=t[3];return e[0]=i+r*(n[0]-i),e[1]=a+r*(n[1]-a),e[2]=o+r*(n[2]-o),e[3]=s+r*(n[3]-s),e}function O(e,t){return t=t||1,e[0]=D.RANDOM(),e[1]=D.RANDOM(),e[2]=D.RANDOM(),e[3]=D.RANDOM(),T(e,e),y(e,e,t),e}function P(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*a+n[12]*o,e[1]=n[1]*r+n[5]*i+n[9]*a+n[13]*o,e[2]=n[2]*r+n[6]*i+n[10]*a+n[14]*o,e[3]=n[3]*r+n[7]*i+n[11]*a+n[15]*o,e}function k(e,t,n){var r=t[0],i=t[1],a=t[2],o=n[0],s=n[1],u=n[2],l=n[3],c=l*r+s*a-u*i,h=l*i+u*r-o*a,f=l*a+o*i-s*r,d=-o*r-s*i-u*a;return e[0]=c*l+d*-o+h*-u-f*-s,e[1]=h*l+d*-s+f*-o-c*-u,e[2]=f*l+d*-u+c*-s-h*-o,e[3]=t[3],e}function S(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function I(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function N(e,t){var n=e[0],r=e[1],i=e[2],a=e[3],o=t[0],s=t[1],u=t[2],l=t[3];return Math.abs(n-o)<=D.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-s)<=D.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-u)<=D.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(a-l)<=D.EPSILON*Math.max(1,Math.abs(a),Math.abs(l))}Object.defineProperty(t,"__esModule",{value:!0}),t.forEach=t.sqrLen=t.len=t.sqrDist=t.dist=t.div=t.mul=t.sub=void 0,t.create=r,t.clone=i,t.fromValues=a,t.copy=o,t.set=s,t.add=u,t.subtract=l,t.multiply=c,t.divide=h,t.ceil=f,t.floor=d,t.min=_,t.max=v,t.round=p,t.scale=y,t.scaleAndAdd=m,t.distance=b,t.squaredDistance=w,t.length=g,t.squaredLength=E,t.negate=M,t.inverse=x,t.normalize=T,t.dot=A,t.lerp=R,t.random=O,t.transformMat4=P,t.transformQuat=k,t.str=S,t.exactEquals=I,t.equals=N;var C=n(3),D=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(C);t.sub=l,t.mul=c,t.div=h,t.dist=b,t.sqrDist=w,t.len=g,t.sqrLen=E,t.forEach=function(){var e=r();return function(t,n,r,i,a,o){var s=void 0,u=void 0;for(n||(n=4),r||(r=0),u=i?Math.min(i*n+r,t.length):t.length,s=r;s<u;s+=n)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],a(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}}()},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e)}return i(e,null,[{key:"decodeArrayBuffer",value:function(e,t){var n=e.length/4*3;return t&&t.byteLength==n||(t=new ArrayBuffer(n)),this.decode(e,t),t}},{key:"removePaddingChars",value:function(e){return 64==this._keyStr.indexOf(e.charAt(e.length-1))?e.substring(0,e.length-1):e}},{key:"decode",value:function(e,t){e=this.removePaddingChars(e),e=this.removePaddingChars(e);var n,r,i,a,o,s,u,l,c=parseInt(e.length/4*3,10),h=0,f=0;for(n=t?new Uint8Array(t):new Uint8Array(c),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""),h=0;h<c;h+=3)o=this._keyStr.indexOf(e.charAt(f++)),s=this._keyStr.indexOf(e.charAt(f++)),u=this._keyStr.indexOf(e.charAt(f++)),l=this._keyStr.indexOf(e.charAt(f++)),r=o<<2|s>>4,i=(15&s)<<4|u>>2,a=(3&u)<<6|l,n[h]=r,64!=u&&(n[h+1]=i),64!=l&&(n[h+2]=a);return n}}]),e}();t.default=a,a._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},function(e,t,n){function i(e){return e&&e.__esModule?e:{default:e}}function a(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(5),h=i(c),f=n(8),d=i(f),_=n(7),v=i(_),p=n(9),y=(i(p),n(0)),m=i(y),b=n(1),w=i(b),g=n(10),E=i(g),M=n(16),x=(i(M),n(11)),T=(i(x),function(e){function t(e,n,r){o(this,t);var i=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r.displayName,r.capabilities.hasExternalDisplay,n));return i._vrDisplay=r,i._vrFrameData=new VRFrameData,i._leftView=new d.default(i._fov,i._depthNear,i._depthFar,d.default.LEFT),i._rightView=new d.default(i._fov,i._depthNear,i._depthFar,d.default.RIGHT),i._views=[i._leftView,i._rightView],i._deviceOrientation=new w.default,i._devicePosition=new E.default,i._deviceWorldMatrix=new Float32Array(16),i}return u(t,e),l(t,[{key:"_requestAnimationFrame",value:function(e){this._vrDisplay.isPresenting?this._vrDisplay.requestAnimationFrame(e):window.requestAnimationFrame(e)}},{key:"_handleNewBaseLayer",value:function(e){var t=this;this._vrDisplay.requestPresent([{source:e._context.canvas}]).then(function(){var n=t._vrDisplay.getEyeParameters("left"),r=t._vrDisplay.getEyeParameters("right");e.framebufferWidth=2*Math.max(n.renderWidth,r.renderWidth),e.framebufferHeight=Math.max(n.renderHeight,r.renderHeight),e._context.canvas.style.position="absolute",e._context.canvas.style.bottom="1px",e._context.canvas.style.right="1px",e._context.canvas.style.width="100%",e._context.canvas.style.height="100%",document.body.appendChild(e._context.canvas)}).catch(function(e){console.error("Unable to init WebVR 1.1 display",e)})}},{key:"_stop",value:function(){!1!==this.running&&(this.running=!1,this._reality._stop())}},{key:"_handleNewFrame",value:function(e){this._vrDisplay.isPresenting&&this._updateFromVRFrameData()}},{key:"_handleAfterFrame",value:function(e){this._vrDisplay.isPresenting&&this._vrDisplay.submitFrame()}},{key:"_supportedCreationParameters",value:function(e){return e.type===v.default.REALITY&&!0===e.exclusive}},{key:"_updateFromVRFrameData",value:function(){if(this._vrDisplay.getFrameData(this._vrFrameData),this._leftView.setViewMatrix(this._vrFrameData.leftViewMatrix),this._rightView.setViewMatrix(this._vrFrameData.rightViewMatrix),this._leftView.setProjectionMatrix(this._vrFrameData.leftProjectionMatrix),this._rightView.setProjectionMatrix(this._vrFrameData.rightProjectionMatrix),this._vrFrameData.pose){if(this._vrFrameData.pose.orientation){var e;(e=this._deviceOrientation).set.apply(e,a(this._vrFrameData.pose.orientation))}if(this._vrFrameData.pose.position){var t;(t=this._devicePosition).set.apply(t,a(this._vrFrameData.pose.position))}m.default.mat4_fromRotationTranslation(this._deviceWorldMatrix,this._deviceOrientation.toArray(),this._devicePosition.toArray()),this._vrDisplay.stageParameters&&this._vrDisplay.stageParameters.sittingToStandingTransform&&m.default.mat4_multiply(this._deviceWorldMatrix,this._vrDisplay.stageParameters.sittingToStandingTransform,this._deviceWorldMatrix),this._headPose._setPoseModelMatrix(this._deviceWorldMatrix),this._eyeLevelPose.position=this._devicePosition.toArray()}}}]),t}(h.default));t.default=T},function(e,t,n){function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(6),c=i(l),h=n(4),f=i(h),d=n(9),_=i(d),v=n(13),p=i(v),y=n(12),m=i(y),b=n(0),w=i(b),g=n(1),E=i(g),M=n(11),x=i(M),T=n(38),A=i(T),R=function(e){function t(e){a(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"Camera",!0,!0));return n._initialized=!1,n._running=!1,n._arKitWrapper=null,n._mediaStream=null,n._videoEl=null,n._arCoreCameraRenderer=null,n._arCoreCanvas=null,n._elContext=null,n._vrDisplay=null,n._vrFrameData=null,n._lightEstimate=new m.default,"function"==typeof navigator.getVRDisplays&&navigator.getVRDisplays().then(function(e){var t=!0,r=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var s=a.value;if(null!==s&&s.capabilities.hasPassThroughCamera){if(n._vrDisplay=s,n._vrFrameData=new VRFrameData,!window.WebARonARKitSetData&&(n._arCoreCanvas=document.createElement("canvas"),n._xr._realityEls.appendChild(n._arCoreCanvas),n._arCoreCanvas.width=window.innerWidth,n._arCoreCanvas.height=window.innerHeight,n._elContext=n._arCoreCanvas.getContext("webgl"),null===n._elContext))throw"Could not create CameraReality GL context";break}}}catch(e){r=!0,i=e}finally{try{!t&&o.return&&o.return()}finally{if(r)throw i}}}),window.addEventListener("resize",function(){n._arCoreCanvas&&(n._arCoreCanvas.width=window.innerWidth,n._arCoreCanvas.height=window.innerHeight)},!1),n}return s(t,e),u(t,[{key:"_handleNewFrame",value:function(e){this._vrDisplay&&(this._arCoreCameraRenderer&&this._arCoreCameraRenderer.render(),this._vrDisplay.getFrameData(this._vrFrameData))}},{key:"_start",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._running||(this._running=!0,null!==this._vrDisplay?(window.WebARonARKitSetData||(this._arCoreCameraRenderer=new A.default(this._vrDisplay,this._elContext)),this._initialized=!0):x.default.HasARKit()?!1===this._initialized?(this._initialized=!0,this._arKitWrapper=x.default.GetOrCreate(),this._arKitWrapper.addEventListener(x.default.WATCH_EVENT,this._handleARKitWatch.bind(this)),this._arKitWrapper.waitForInit().then(function(){e._arKitWrapper.watch(t)})):this._arKitWrapper.watch(t):!1===this._initialized?(this._initialized=!0,navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment"}}).then(function(t){e._videoEl=document.createElement("video"),e._xr._realityEls.appendChild(e._videoEl),e._videoEl.setAttribute("class","camera-reality-video"),e._videoEl.setAttribute("playsinline",!0),e._videoEl.style.width="100%",e._videoEl.style.height="100%",e._videoEl.srcObject=t,e._videoEl.play()}).catch(function(t){console.error("Could not set up video stream",t),e._initialized=!1,e._running=!1})):(this._xr._realityEls.appendChild(this._videoEl),this._videoEl.play()))}},{key:"_stop",value:function(){if(!1!==this._running)if(this._running=!1,x.default.HasARKit()){if(null===this._arKitWrapper)return;this._arKitWrapper.stop()}else this._arCoreCanvas?(this._xr._realityEls.removeChild(this._arCoreCanvas),this._arCoreCanvas=null):null!==this._videoEl&&(this._videoEl.pause(),this._xr._realityEls.removeChild(this._videoEl))}},{key:"_handleARKitWatch",value:function(e){if(e.detail&&e.detail.objects){var t=!0,n=!1,r=void 0;try{for(var i,a=e.detail.objects[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;this._updateAnchorFromARKitUpdate(o.uuid,o)}}catch(e){n=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}}if(e.detail&&e.detail.removedObjects){var s=!0,u=!1,l=void 0;try{for(var c,h=e.detail.removedObjects[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var f=c.value;this._deleteAnchorFromARKitUpdate(f)}}catch(e){u=!0,l=e}finally{try{!s&&h.return&&h.return()}finally{if(u)throw l}}}}},{key:"_deleteAnchorFromARKitUpdate",value:function(e){this._anchors.delete(e)}},{key:"_handleARKitAddObject",value:function(e){this._updateAnchorFromARKitUpdate(e.uuid,e)}},{key:"_updateAnchorFromARKitUpdate",value:function(e,t){var n=this._anchors.get(e)||null;null!==n&&(n.coordinateSystem._relativeMatrix=t.transform)}},{key:"_addAnchor",value:function(e,t){var n=this;return null!==this._arKitWrapper&&this._arKitWrapper.addAnchor(e.uid,e.coordinateSystem._poseModelMatrix).then(function(e){return n._handleARKitAddObject(e)}),this._anchors.set(e.uid,e),e.uid}},{key:"_findAnchor",value:function(e,t,n){var r=this;return new Promise(function(i,a){if(null!==r._arKitWrapper)r._arKitWrapper.hitTest(e,t,x.default.HIT_TEST_TYPE_EXISTING_PLANES).then(function(e){if(0===e.length)return void i(null);var t=r._pickARKitHit(e);t.anchor_transform[13]+=_.default.SITTING_EYE_HEIGHT,t.world_transform[13]+=_.default.SITTING_EYE_HEIGHT;var a=r._getAnchor(t.uuid);if(null===a){var o=new XRCoordinateSystem(n,XRCoordinateSystem.TRACKER);o._relativeMatrix=t.anchor_transform,a=new f.default(o,t.uuid),r._anchors.set(a.uid,a)}var s=[t.world_transform[12]-t.anchor_transform[12],t.world_transform[13]-t.anchor_transform[13],t.world_transform[14]-t.anchor_transform[14]],u=(new E.default).setFromRotationMatrix(t.world_transform),l=(new E.default).setFromRotationMatrix(t.anchor_transform).inverse(),c=(new E.default).multiplyQuaternions(u,l),h=new p.default(a.uid);h.poseMatrix=w.default.mat4_fromRotationTranslation(new Float32Array(16),c.toArray(),s),i(h)});else if(null!==r._vrDisplay){var o=r._vrDisplay.hitTest(e,t);if(0==o.length)return void i(null);o.sort(function(e,t){return e.distance-t.distance});var s=r._getAnchor(o[0].uuid);if(null===s){var u=new XRCoordinateSystem(n,XRCoordinateSystem.TRACKER);u._relativeMatrix=o[0].modelMatrix,u._relativeMatrix[13]+=_.default.SITTING_EYE_HEIGHT,s=new f.default(u),r._anchors.set(s.uid,s)}i(new p.default(s.uid))}else i(null)})}},{key:"_removeAnchor",value:function(e){x.default.removeAnchor(e)}},{key:"_pickARKitHit",value:function(e){if(0===e.length)return null;var t=null,n=e.filter(function(e){return e.type!=x.default.HIT_TEST_TYPE_FEATURE_POINT}),r=n.filter(function(e){return e.type==x.default.HIT_TEST_TYPE_EXISTING_PLANE_USING_EXTENT}),i=n.filter(function(e){return e.type==x.default.HIT_TEST_TYPE_EXISTING_PLANE});return r.length?(r=r.sort(function(e,t){return e.distance-t.distance}),t=r[0]):i.length?(i=i.sort(function(e,t){return e.distance-t.distance}),t=i[0]):n.length?(n=n.sort(function(e,t){return e.distance-t.distance}),t=n[0]):t=e[0],t}},{key:"_hitTestNoAnchor",value:function(e,t,n){if(null!==this._arKitWrapper){for(var r=this._arKitWrapper.hitTestNoAnchor(e,t),i=0;i<r.length;i++)r[i].modelMatrix[13]+=_.default.SITTING_EYE_HEIGHT;return 0==r.length?null:r}if(null!==this._vrDisplay){for(var a=this._vrDisplay.hitTest(e,t),o=0;o<a.length;o++)a[o].modelMatrix[13]+=_.default.SITTING_EYE_HEIGHT;return 0==a.length?null:a}return null}},{key:"_getHasLightEstimate",value:function(){return null!==this._arKitWrapper}},{key:"_getLightAmbientIntensity",value:function(){return null!==this._arKitWrapper?(this._lightEstimate.ambientIntensity=this._arKitWrapper.lightIntensity,this._lightEstimate.ambientIntensity):null}},{key:"_findFloorAnchor",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise(function(e,t){e(null)})}}]),t}(c.default);t.default=R},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t,n){if("fragment"==n)var r=e.createShader(e.FRAGMENT_SHADER);else{if("vertex"!=n)return null;var r=e.createShader(e.VERTEX_SHADER)}return e.shaderSource(r,t),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)?r:(console.error(e.getShaderInfoLog(r)),null)}function a(e,t,n){var r=i(e,t,"vertex"),a=i(e,n,"fragment");if(!a)return null;var o=e.createProgram();return e.attachShader(o,r),e.attachShader(o,a),e.linkProgram(o),e.getProgramParameter(o,e.LINK_STATUS)||console.error("Could not initialise arview shaders"),o}function o(e,t){var n=0;switch(t){case 90:n=1;break;case 180:n=2;break;case 270:n=3;break;default:n=0}var r=0;switch(e){case 90:r=1;break;case 180:r=2;break;case 270:r=3;break;default:r=0}var i=r-n;return i<0&&(i+=4),i%4}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u="#extension GL_OES_EGL_image_external : require\n\nprecision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform samplerExternalOES uSampler;\n\nvoid main(void) {\n  gl_FragColor = texture2D(uSampler, vTextureCoord);\n}",l="attribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void) {\n  gl_Position = vec4(aVertexPosition, 1.0);\n  vTextureCoord = aTextureCoord;\n}",c=function(){function e(t,n){r(this,e),this.vrDisplay=t,this.gl=n,this.passThroughCamera=t.getPassThroughCamera(),this.program=a(n,l,u),n.useProgram(this.program),this.vertexPositionAttribute=n.getAttribLocation(this.program,"aVertexPosition"),this.textureCoordAttribute=n.getAttribLocation(this.program,"aTextureCoord"),this.samplerUniform=n.getUniformLocation(this.program,"uSampler"),this.vertexPositionBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.vertexPositionBuffer);var i=[-1,1,0,-1,-1,0,1,1,0,1,-1,0],s=new Float32Array(i);n.bufferData(n.ARRAY_BUFFER,s,n.STATIC_DRAW),this.vertexPositionBuffer.itemSize=3,this.vertexPositionBuffer.numItems=12,this.textureCoordBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.textureCoordBuffer);var c=null;if(this.vrDisplay){var h=this.passThroughCamera.width/this.passThroughCamera.textureWidth,f=this.passThroughCamera.height/this.passThroughCamera.textureHeight;c=[[0,0,0,f,h,0,h,f],[h,0,0,0,h,f,0,f],[h,f,h,0,0,f,0,0],[0,f,h,f,0,0,h,0]]}else c=[[0,0,0,1,1,0,1,1],[1,0,0,0,1,1,0,1],[1,1,1,0,0,1,0,0],[0,1,1,1,0,0,1,0]];this.f32TextureCoords=[];for(var d=0;d<c.length;d++)this.f32TextureCoords.push(new Float32Array(c[d]));this.combinedOrientation=o(screen.orientation.angle,this.passThroughCamera.orientation),n.bufferData(n.ARRAY_BUFFER,this.f32TextureCoords[this.combinedOrientation],n.STATIC_DRAW),this.textureCoordBuffer.itemSize=2,this.textureCoordBuffer.numItems=8,n.bindBuffer(n.ARRAY_BUFFER,null),this.indexBuffer=n.createBuffer(),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var _=[0,1,2,2,1,3],v=new Uint16Array(_);return n.bufferData(n.ELEMENT_ARRAY_BUFFER,v,n.STATIC_DRAW),this.indexBuffer.itemSize=1,this.indexBuffer.numItems=6,n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),this.texture=n.createTexture(),n.useProgram(null),this.projectionMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.mvMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this}return s(e,[{key:"render",value:function(){var e=this.gl;e.useProgram(this.program),e.bindBuffer(e.ARRAY_BUFFER,this.vertexPositionBuffer),e.enableVertexAttribArray(this.vertexPositionAttribute),e.vertexAttribPointer(this.vertexPositionAttribute,this.vertexPositionBuffer.itemSize,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this.textureCoordBuffer);var t=o(screen.orientation.angle,this.passThroughCamera.orientation);t!==this.combinedOrientation&&(this.combinedOrientation=t,e.bufferData(e.ARRAY_BUFFER,this.f32TextureCoords[this.combinedOrientation],e.STATIC_DRAW)),e.enableVertexAttribArray(this.textureCoordAttribute),e.vertexAttribPointer(this.textureCoordAttribute,this.textureCoordBuffer.itemSize,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_EXTERNAL_OES,this.texture),e.texImage2D(e.TEXTURE_EXTERNAL_OES,0,e.RGB,e.RGB,e.UNSIGNED_BYTE,this.passThroughCamera),e.uniform1i(this.samplerUniform,0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.drawElements(e.TRIANGLES,this.indexBuffer.numItems,e.UNSIGNED_SHORT,0),e.bindTexture(e.TEXTURE_EXTERNAL_OES,null),e.disableVertexAttribArray(this.vertexPositionAttribute),e.disableVertexAttribArray(this.textureCoordAttribute),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.useProgram(null)}}]),e}(),h=function(){function e(t,n){r(this,e),this.vrDisplay=t,this.gl=n,this.videoRenderer=new c(t,this.gl),this.width=window.innerWidth,this.height=window.innerHeight,window.addEventListener("resize",this.onWindowResize.bind(this),!1)}return s(e,[{key:"onWindowResize",value:function(){this.width=window.innerWidth,this.height=window.innerHeight}},{key:"render",value:function(){var e=this.gl,t=1*this.width,n=1*this.height;e.viewportWidth!==t&&(e.viewportWidth=t),e.viewportHeight!==n&&(e.viewportHeight=n),this.gl.viewport(0,0,e.viewportWidth,e.viewportHeight),this.videoRenderer.render()}}]),e}();t.default=h}])}]);